<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="merchbill.commodity">
    <!--1、查询商品表所有的商品 【商品表、商品类别表】 -->
    <select id="searchCommodityAll" resultMap="commodity">
        SELECT comId,comName,comSimpleCode,c.duo1,comType.catName title,comGenericName,comBarCode,comUnit,
        comEpherine,comElectonic,comProduct,comMedicame,comRegister,comApproval,comState,
        comSpecial,comPurchase,comPrice,comManufact,comRemarks,comMinKuNumber FROM commodity c
        INNER JOIN category comType
        ON comType.catId=c.comTypeId
    </select>
    <!--2、根据商品表的商品编号查询商品所属类型【根据单击的二级子类的类型编号查所属的信息】【商品表、商品类别表、生产厂商表、库存明细表】-->
    <select id="searchCommodityForTypeAll" resultMap="repertorySonMap"  parameterType="String">
    select rep.repId,man.manId,com.comId,comType.catId,com.duo1,com.comPurchase duo5,com.comApproval,com.comName,com.comUnit,com.comProduct,com.comPrice,
	    rep.reqCurrent,man.manName,comType.catName title from commodity com
      inner join manufacturer man
      on com.comManufact = man.manId
      inner join repertoryson rep
      on rep.repComId = com.comId
      inner join category comType
      on comType.catId=com.comTypeId
      where comType.catId= #{siteTag}
    </select>
    <!--3、查询商品类别父类别【商品列表的树形控件的一级父类[处方药] 父Id是否为null】-->
    <select id="searchCommodityTypeParent" resultMap="categoryt">
        SELECT catId,catParentId,catSort,catExplain,catName title FROM category
        WHERE catParentId IS NULL
    </select>
    <!--4、根据父类查询父类的子类【商品列表的树形控件的一级父类里的二级子类[处方药 》抗微生物药]】-->
    <select id="searchCommodityType" resultMap="categoryt" parameterType="string">
        SELECT catId,catParentId,catSort,catExplain,catName title FROM category
        WHERE catParentId=#{parentid}
    </select>

    <!--库存明细表Map-->
    <resultMap id="repertorySonMap" type="repertorySon">
        <id column="repId" property="repId"/>
        <result column="repProName" property="repProName"/>
        <result column="repNumber" property="repNumber"/>
        <result column="reqTotality" property="reqTotality"/>
        <result column="reqPrice" property="reqPrice"/>
        <result column="reqShouPrice" property="reqShouPrice"/>
        <result column="reqCurrent" property="reqCurrent"/>
        <result column="reqLowest" property="reqLowest"/>
        <result column="reqWareNo" property="reqWareNo"/>
        <result column="duo1" property="duo1"/>
        <result column="duo2" property="duo2"/>
        <result column="duo3" property="duo3"/>
        <result column="duo4" property="duo4"/>
        <result column="duo5" property="duo5"/>
        <!--1.库存明细表的商品编号【repComId】FK 对应 商品表的商品编号【comId】PK  【库存数】-->
        <!--<result column="repComId" property="repComId"/>-->
        <association property="commodity" resultMap="commodity">
        </association>
    </resultMap>

    <!--商品表Map-->
    <resultMap id="commodity" type="commodity">
        <id column="comId" property="comId"/>
        <result column="comName" property="comName"/>
        <result column="comSimpleCode" property="comSimpleCode"/>
        <result column="comTypeId" property="comTypeId"/>
        <result column="comGenericName" property="comGenericName"/>
        <result column="comBarCode" property="comBarCode"/>
        <result column="comUnit" property="comUnit"/>
        <result column="comEpherine" property="comEpherine"/>
        <result column="comElectonic" property="comElectonic"/>
        <result column="comProduct" property="comProduct"/>
        <result column="comMedicame" property="comMedicame"/>
        <result column="comRegister" property="comRegister"/>
        <result column="comApproval" property="comApproval"/>
        <result column="comQuality" property="comQuality"/>
        <result column="comState" property="comState"/>
        <result column="comSpecial" property="comSpecial"/>
        <result column="comPurchase" property="comPurchase"/>
        <result column="comPrice" property="comPrice"/>
        <result column="comRemarks" property="comRemarks"/>
        <result column="comMinKuNumber" property="comMinKuNumber"/>
        <result column="duo1" property="duo1"/>
        <result column="duo2" property="duo2"/>
        <result column="duo4" property="duo4"/>
        <result column="duo5" property="duo5"/>
        <!--商品类别-->
        <association property="category" javaType="category" resultMap="categoryt">
        </association>
        <!--生产厂商-->
        <association property="manufacturer" javaType="manufacturer" resultMap="manufacturer">
        </association>
    </resultMap>

    <!--生产厂商表Map-->
    <resultMap id="manufacturer" type="manufacturer">
        <id column="manId" property="manId"/>
        <result column="manName" property="manName"/>
        <result column="manTelPhe" property="manTelPhe"/>
        <result column="manAddressNo" property="manAddressNo"/>
        <result column="manAddress" property="manAddress"/>
        <result column="manEmail" property="manEmail"/>
        <result column="manRemarks" property="manRemarks"/>
        <result column="duo1" property="duo1"/>
        <result column="duo2" property="duo2"/>
    </resultMap>

    <resultMap id="categoryt" type="category">
        <id column="catId" property="catId"></id>
        <result column="catParentId" property="catParentId"></result>
        <result column="catSort" property="catSort"></result>
        <result column="catExplain" property="catExplain"></result>
        <result column="title" property="title"></result>
    </resultMap>

</mapper>