<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="member.crud">
    <!--1、查询会员信息-->
    <select id="searchMember" resultMap="membermap">
        select * from members where memStateNo=1
        limit #{page},#{limit}
    </select>
    <resultMap id="membermap" type="members">
        <!--mybatis如何处理联合主键(复合主键)?-->
        <id column="memNo" property="memNo"/>
        <result column="memName" property="memName"/>
        <result column="memGrade" property="memGrade"/>
        <result column="memIntegral" property="memIntegral"/>
        <result column="memExpenditure" property="memExpenditure"/>
        <result column="memDeqree" property="memDeqree"/>
        <result column="memIntegralBalance" property="memIntegralBalance"/>
        <result column="memCardBalance" property="memCardBalance"/>
        <result column="memStateNo" property="memStateNo"/>
        <result column="memIntergralUp" property="memIntergralUp"/>
        <result column="memPreferential" property="memPreferential"/>
        <result column="memTime" property="memTime"/>
        <result column="memJoinDate" property="memJoinDate"/>
        <result column="memExpireDate" property="memExpireDate"/>
        <result column="memPhone" property="memPhone"/>
        <result column="memRemark" property="memRemark"/>
    </resultMap>



    <!--新增会员信息-->
    <insert id="insertMember" parameterType="java.util.List">
        INSERT INTO members(memNo,memGrade,memPreferential,
        memName,memIntegral,memPhone,memRemark,memJoinDate,memExpireDate)
        value(#{memNo},#{memGrade},#{memPreferential},#{memName},#{memIntegral},#{memPhone},
        #{memRemark},#{memJoinDate},#{memExpireDate})
    </insert>

    <!--删除会员信息-虚假的删除，只是改变会员状态-->
    <update id="deleteMember" parameterType="java.lang.String">
        UPDATE members set memStateNo=0 WHERE memNo IN
        <foreach collection="array" item="memNo" open="(" separator="," close=")">
          #{memNo}
        </foreach>
    </update>
    <!--<delete id="deleteMember" parameterType="java.lang.String">-->
        <!--DELETE from members where memNo IN-->
        <!--<foreach collection="array" item="memNo" open="(" separator="," close=")">-->
          <!--#{memNo}-->
        <!--</foreach>-->
    <!--</delete>-->

    <!--编辑会员信息-->
    <select id="updateMember" parameterType="java.lang.String">
        UPDATE members SET memGrade = #{memGrade},
         memPreferential = #{memPreferential}, memName = #{memName},
         memPhone = #{memPhone}, memRemark = #{memRemark},memExpireDate=#{memExpireDate}
        WHERE memNo = #{memNo}
    </select>

    <!--查询会员最大编号-->
    <select id="selectMaxMember" resultType="string">
        select MAX(memNo) memNo from members
    </select>

    <!--查询分页时总条数-->
    <select id="searchSize" resultType="int">
        select COUNT(*) memNo from members
    </select>

    <select id="selectWhereMembers" resultMap="membermap">
        select *
        from members
        where memStateNo=1
        <if test="memName!=null and memName!=''">
            AND memName like concat('%',#{memName},'%')
        </if>
        limit #{page},#{limit}
    </select>
</mapper>


