<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="client.crud">
    <!--查询总条数-->
    <select id="countNum" resultType="int">
        select count(*) from client
    </select>
    <!--分页查询-->
    <select id="searchClientMapList" resultMap="clientMap" parameterType="com.medicine.util.Page">
        select client.*,employees.empName,province.proId,province.proName,city.citId,
        city.citName,district.disId,district.disName,client_type.cltID,client_type.cltName from client
        inner join province on province.proId = client.cliProId
        inner join city on city.citId = client.cliCitId
        inner join district on district.disId = client.cliDisId
        inner join client_type on client_type.cltID = client.cliType
        inner join employees on employees.empNo = client.cliContacts
        where client.cliStatus = 1
        order by client.cliID
        <if test="page!=null and limit!=null">
            limit #{page},#{limit}
        </if>
    </select>
    <!--客户主键自增(查询最大的编号)-->
    <select id="clientId" resultType="String">
        select max(cliId) from client
    </select>
    <!--新增客户-->
    <insert id="clientInsert" parameterType="java.util.List">
        insert into client(cliID,cliName,cliSex,cliContacts,cliPhone,cliReceivableMoney,
        cliAddress,cliType,cliDate,cliArea,cliCardNumber,cliChecked,cliRemarks,
        cliAddressNo,cliProId,cliCitId,cliDisId)
        value(#{cliID},#{cliName},#{cliSex},#{cliContacts},#{cliPhone},#{cliReceivableMoney}
        ,#{cliAddress},#{cliType},#{cliDate},#{cliArea},#{cliCardNumber},#{cliChecked}
        ,#{cliRemarks},#{cliAddressNo},#{cliProId},#{cliCitId},#{cliDisId})
    </insert>
    <!--删除客户-->
    <select id="clientDelete" resultMap="clientMap" parameterType="String">
        <!--delete from client where cliID in
        <foreach item="cliID" collection="array" index="no" open="(" separator="," close=")">
            #{cliID}
        </foreach>-->
        update client set cliStatus = 0 where cliID in
        <foreach collection="array" item="cliID" open="(" separator="," close=")">
            #{cliID}
        </foreach>
    </select>
    <!--编辑客户-->
    <select id="clientUpdate" resultMap="clientMap" parameterType="Client">
        update client set cliName = #{cliName},cliSex = #{cliSex}, cliPhone = #{cliPhone}, cliReceivableMoney = #{cliReceivableMoney},
        cliAddressNo = #{cliAddressNo}, cliAddress = #{cliAddress}, cliType = #{cliType}, cliCardNumber = #{cliCardNumber}, cliChecked = #{cliChecked}
        , cliRemarks = #{cliRemarks}, cliContacts = #{cliContacts}, cliArea = #{cliArea}
        where cliID = #{cliID}
    </select>
    <!--编辑客户类型-->
    <select id="clientTypeUpdate" resultMap="clientTypeMap" parameterType="ClientType">
        update client_type set cltName = #{cltName} where cltID = #{cltID}
    </select>
    <!--查询客户类型-->
    <select id="searchClientType" resultMap="clientTypeMap">
        select * from client_type where cltStatus = 1
    </select>
    <!--客户类型主键自增(查询最大的编号)-->
    <select id="clientTypeId" resultType="String">
        select max(cltID) from client_type
    </select>
    <!--查询员工信息(联系人)-->
    <select id="searchEmployees" resultMap="employeesMap">
        select empNo,empName from employees where empState = 1
    </select>
    <!--删除客户类型信息-->
    <select id="clientTypeDelete" resultMap="clientTypeMap" parameterType="String">
        update client_type set cltStatus = 0
        where cltID = #{cltID}
        <!--<foreach item="cltID" collection="array" index="no" open="(" separator="," close=")">
            #{cliID}
        </foreach>-->
    </select>
    <!--新增客户类型信息-->
    <insert id="clientTypeInsert" parameterType="clientType">
        insert into client_type(cltID,cltName) values(#{cltID},#{cltName})
    </insert>
    <resultMap id="clientMap" type="Client">
        <id column="cliID" property="cliID"/>
        <result column="cliName" property="cliName"/>
        <result column="cliSex" property="cliSex"/>
        <result column="cliDate" property="cliDate"/>
        <result column="cliContacts" property="cliContacts"/>
        <result column="cliPhone" property="cliPhone"/>
        <result column="cliReceivableMoney" property="cliReceivableMoney"/>
        <result column="cliAddressNo" property="cliAddressNo"/>
        <result column="cliAddress" property="cliAddress"/>
        <!--<result column="cliType" property="cliType"/>-->
        <result column="cliArea" property="cliArea"/>
        <result column="cliCardNumber" property="cliCardNumber"/>
        <result column="cliChecked" property="cliChecked"/>
        <result column="cliStatus" property="cliStatus"/>
        <result column="cliRemarks" property="cliRemarks"/>
        <result column="cliProId" property="cliProId"/>
        <result column="cliCitId" property="cliCitId"/>
        <result column="cliDisId" property="cliDisId"/>
        <association property="clientType" resultMap="clientTypeMap">

        </association>
        <association property="employees" resultMap="employeesMap">

        </association>
        <!--包含省份表-->
        <association property="province" javaType="province">
            <id column="proId" property="proId"/>
            <result column="proName" property="proName"/>
            <result column="proSort" property="proSort"/>
            <result column="proDescription" property="proDescription"/>
        </association>
        <!--包含市级表-->
        <association property="city" javaType="city">
            <id column="citId" property="citId"/>
            <result column="citName" property="citName"/>
            <result column="citSort" property="citSort"/>
            <result column="citProvinceNo" property="citProvinceNo"/>
            <result column="citDescription" property="citDescription"/>
        </association>
        <!--包含区级表-->
        <association property="district" javaType="district">
            <id column="disId" property="disId"/>
            <result column="disName" property="disName"/>
            <result column="disSort" property="disSort"/>
            <result column="disCityNo" property="disCityNo"/>
            <result column="disDescription" property="disDescription"/>
        </association>
    </resultMap>
    <resultMap id="clientTypeMap" type="ClientType">
        <id column="cltID" property="cltID"/>
        <result column="cltName" property="cltName"/>
        <result column="cltStatus" property="cltStatus"/>
        <result column="cltRemark" property="cltRemark"/>
    </resultMap>
    <resultMap id="employeesMap" type="Employees">
        <result column="empName" property="empName"/>
        <result column="empSex" property="empSex"/>
        <result column="empTel" property="empTel"/>
        <result column="empEmail" property="empEmail"/>
        <result column="empRatio" property="empRatio"/>
        <result column="empDutyNo" property="empDutyNo"/>
        <result column="empRemark" property="empRemark"/>
        <result column="empSalary" property="empSalary"/>
        <result column="empAddressNo" property="empAddressNo"/>
        <result column="empBirthday" property="empBirthday"/>
        <result column="empHiredate" property="empHiredate"/>
        <result column="userName" property="userName"/>
        <result column="userPass" property="userPass"/>
    </resultMap>
</mapper>
