<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="merchbillReturn.crud">
    <!--1、查询所有商品清单信息的集合(包括商品信息)-->
    <select id="searchMerchBillReturnList" resultMap="repertorySonMap" parameterType="String">
        SELECT * FROM commodity com
        INNER JOIN manufacturer man
        ON com.comManufact = man.manId
        INNER JOIN repertoryson rep
        ON rep.repComId = com.comId
        inner join supplier on supID=comSupplierNo
        where 1=1
        <if test="null != recWareNo and '' != recWareNo">
            AND reqWareNo = #{recWareNo}
        </if>
        <if test="null != recRemark and '' != recRemark">
            AND comSupplierNo=#{recRemark}
        </if>
        <if test="null != recNo and '' != recNo">
            AND comId like "%" #{recNo} "%"
        </if>
        <if test="null != recOdd and '' != recOdd">
            AND comName like "%" #{recOdd} "%"
        </if>
    </select>

    <!--2、查询所有商品信息-->
    <select id="searchCommodityAll" resultMap="Commodity">
        SELECT comId,comName,comSimpleCode,comType.catName title,comGenericName,comBarCode,comUnit,
        comEpherine,comElectonic,comProduct,comMedicame,comRegister,comApproval,comState,
        comSpecial,comPurchase,comPrice,comManufact,comRemarks,comMinKuNumber,comStarTime,comEndTime,c.duo2,c.duo4,c.duo5 FROM commodity c
        INNER JOIN category comType
        ON comType.catId=c.comTypeId
    </select>

    <!--3、根据商品类别编号查询商品信息-->
    <select id="searchCommodityForTypeAll" resultMap="repertorySonMap"  parameterType="String">
        select rep.repId,man.manId,com.comId,comType.catId,com.comName,com.comUnit,com.comProduct,com.comPrice,
        rep.repNumber,man.manName,comType.catName title,com.duo1,com.duo2,com.duo4,com.duo5 from commodity com
        inner join manufacturer man
        on com.comManufact = man.manId
        inner join repertoryson rep
        on rep.repComId = com.comId
        inner join category comType
        on comType.catId=com.comTypeId
        where comType.catId= #{siteTag}  or comType.catParentId=#{siteTag}
    </select>

    <!--4、查询商品类别父类别-->
    <select id="searchCommodityTypeParent" resultMap="categoryt">
        SELECT catId,catParentId,catSort,catExplain,catName title FROM category
        WHERE catParentId IS NULL
    </select>

    <!--5、查询商品类别子类别-->
    <select id="searchCommodityType" resultMap="categoryt" parameterType="string">
        SELECT catId,catParentId,catSort,catExplain,catName title FROM category
        WHERE catParentId=#{parentid}
    </select>

    <!--6、新增单据明细表-->
    <insert id="insertReceiptsDetailed" parameterType="receiptsDetailed">
        insert into receipts_detailed(redNo,redOdd,redProcutsNo,redName,redUnit,redredduct,
        redPermitNo,redPrice,redCount,redManufact,redRecNo)
        values(#{redNo},#{redOdd},#{redProcutsNo},#{redName},#{redUnit},#{redredduct},
        #{redPermitNo},#{redPrice},#{redCount},#{redManufact},
        #{redRecNo})
    </insert>

    <!--7、新增单据主表信息-->
    <insert id="insertReceiptsInfo" parameterType="receipts">
        insert into receipts (recNo,recOdd,recDocumentTypes,recDate,
        recEmployeeNo,recRemark,recTiaoNumber,recTotalNumber,
        redPutNo,redDepotNo) values(#{recNo},#{recOdd},#{recDocumentTypes},#{recDate},
        #{recEmployeeNo},#{recRemark},#{recTiaoNumber},#{recTotalNumber},#{redPutNo}
        ,#{redDepotNo})
    </insert>

    <!--8、修改库存入库信息-->
    <update id="updateRepertorySonInInfo" parameterType="receiptsDetailed">
        update repertoryson set reqCurrent=(reqCurrent-#{redCount})
        where repComId=#{redProcutsNo}
        <if test="null != duo1 and '' != duo1">
            and repId = #{duo1}
        </if>
    </update>

    <!--单据明细表Map-->
    <resultMap id="receiptsDetailed" type="receiptsDetailed">
        <id column="redNo" property="redNo"/>
        <result column="redOdd" property="redOdd"/>
        <result column="redName" property="redName"/>
        <result column="redUnit" property="redUnit"/>
        <result column="redredduct" property="redredduct"/>
        <result column="redPermitNo" property="redPermitNo"/>
        <result column="redDate" property="redDate"/>
        <result column="redValidUntil" property="redValidUntil"/>
        <result column="redPrice" property="redPrice"/>
        <result column="redCount" property="redCount"/>
        <result column="redManufact" property="redManufact"/>
        <result column="redManufactName" property="redManufactName"/>
        <result column="redPreprice" property="redPreprice"/>
        <result column="redTotalPrice" property="redTotalPrice"/>
        <result column="redSupplierNo" property="redSupplierNo"/>
        <result column="redPutNo" property="redPutNo"/>
        <result column="redDepotNo" property="redDepotNo"/>
        <result column="redredchaseDate" property="redredchaseDate"/>
        <result column="redComment" property="redComment"/>
        <result column="redReturnDate" property="redReturnDate"/>
        <result column="redDocumentTypes" property="redDocumentTypes"/>
        <result column="redProductTypeNo" property="redProductTypeNo"/>
        <result column="redProductTypeName" property="redProductTypeName"/>
        <result column="redRecNo" property="redRecNo"/>
        <result column="redZhe" property="redZhe"/>
        <result column="redModel" property="redModel"/>
        <result column="redQuanStock" property="redQuanStock"/>
        <result column="redCountedQuantity" property="redCountedQuantity"/>
        <result column="duo1" property="duo1"/>
        <result column="duo2" property="duo2"/>
        <result column="duo4" property="duo4"/>
        <result column="duo5" property="duo5"/>
        <result column="duo6" property="duo6"/>
        <result column="duo7" property="duo7"/>
        <!--1.单据明细表的商品编号【redProcutsNo】FK 对应 商品表的商品编号【comId】PK  【最近进货】-->
        <!--<result column="redProcutsNo" property="redProcutsNo"/>-->
        <association property="commodity" resultMap="Commodity">
        </association>
    </resultMap>

    <!--商品类别Map-->
    <resultMap id="categoryt" type="category">
        <id column="catId" property="catId"></id>
        <result column="catParentId" property="catParentId"></result>
        <result column="catSort" property="catSort"></result>
        <result column="catExplain" property="catExplain"></result>
        <result column="title" property="title"></result>
    </resultMap>

    <!--库存明细表Map-->
    <resultMap id="repertorySonMap" type="repertoryson">
        <id column="repId" property="repId"/>
        <result column="repProName" property="repProName"/>
        <result column="repNumber" property="repNumber"/>
        <result column="reqTotality" property="reqTotality"/>
        <result column="reqPrice" property="reqPrice"/>
        <result column="reqShouPrice" property="reqShouPrice"/>
        <result column="reqCurrent" property="reqCurrent"/>
        <result column="reqLowest" property="reqLowest"/>
        <result column="reqWareNo" property="reqWareNo"/>
        <result column="duo1" property="duo1"/>
        <result column="duo2" property="duo2"/>
        <result column="duo3" property="duo3"/>
        <result column="duo4" property="duo4"/>
        <result column="duo5" property="duo5"/>
        <!--1.库存明细表的商品编号【repComId】FK 对应 商品表的商品编号【comId】PK  【库存数】-->
        <!--<result column="repComId" property="repComId"/>-->
        <association property="commodity" resultMap="Commodity">
        </association>
    </resultMap>

    <!--商品表Map-->
    <resultMap id="Commodity" type="commodity">
        <id column="comId" property="comId"/>
        <result column="comName" property="comName"/>
        <result column="comSimpleCode" property="comSimpleCode"/>
        <!--<result column="comTypeId" property="comTypeId"/>-->
        <result column="comGenericName" property="comGenericName"/>
        <result column="comBarCode" property="comBarCode"/>
        <result column="comUnit" property="comUnit"/>
        <result column="comEpherine" property="comEpherine"/>
        <result column="comElectonic" property="comElectonic"/>
        <result column="comProduct" property="comProduct"/>
        <result column="comMedicame" property="comMedicame"/>
        <result column="comRegister" property="comRegister"/>
        <result column="comApproval" property="comApproval"/>
        <!--<result column="comQuality" property="comQuality"/>-->
        <result column="comState" property="comState"/>
        <result column="comSpecial" property="comSpecial"/>
        <result column="comPurchase" property="comPurchase"/>
        <result column="comPrice" property="comPrice"/>
        <result column="comRemarks" property="comRemarks"/>
        <result column="comMinKuNumber" property="comMinKuNumber"/>
        <result column="comStarTime" property="comStarTime"/>
        <result column="comEndTime" property="comEndTime"/>
        <result column="duo1" property="duo1"/>
        <result column="duo2" property="duo2"/>
        <result column="duo4" property="duo4"/>
        <result column="duo5" property="duo5"/>
        <!--2.商品表的生产厂商编号【comManufact】FK对应 生产厂商表的生产厂商编号【manId】PK-->
        <!-- <result column="comManufact" property="comManufact"/>-->
        <association property="category" javaType="category" resultMap="categoryt">
        </association>
        <association property="manufacturer" resultMap="Manufacturer" >
        </association>
    </resultMap>

    <!--生产厂商表Map-->
    <resultMap id="Manufacturer" type="manufacturer">
        <id column="manId" property="manId"/>
        <result column="manName" property="manName"/>
        <result column="manTelPhe" property="manTelPhe"/>
        <result column="manAddressNo" property="manAddressNo"/>
        <result column="manAddress" property="manAddress"/>
        <result column="manEmail" property="manEmail"/>
        <result column="manRemarks" property="manRemarks"/>
        <result column="duo1" property="duo1"/>
        <result column="duo2" property="duo2"/>
    </resultMap>
</mapper>