<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>客户信息管理系统</title>
    <link rel="stylesheet" href="layui/css/layui.css?t=1573457678857" media="all">
    <style>
        body {
            margin-top: -10px;
        }

        table tr td {
            padding-top: 12px;
        }

        .input {
            width: 112px;
            height: 20px;
        }

        .inputOne {
            width: 308px;
            height: 20px;
        }

        .inputTwo {
            width: 94px;
            height: 23px;
        }

        /*.inputFive {
            width: 94px;
            height: 23px;
        }*/

        .inputThree {
            width: 125px;
            height: 20px;
        }

        .inputFour {
            width: 116px;
            height: 23px;
        }

        /*自定义layer.tab的skin皮肤颜色*/
        body .demo-class .layui-layer-title {
            background: #1e1e19;
            color: #fff;
            border: none;
        }

        body .demo-class .layui-layer-btn {
            border-top: 1px solid #E9E7E7
        }

        body .demo-class .layui-layer-btn a {
            background: #333;
        }

        body .demo-class .layui-layer-btn .layui-layer-btn1 {
            background: #999;
        }
    </style>
</head>
<body>


<table class="layui-hide" id="cliet" lay-filter="test" lay-data="{id: 'idTest'}">
</table>
<!--新增框-->
<div class="layui-row" id="addClient" style="display: none">
    <div class="layui-col-md11">
        <form lay-filter="formTestFilter2121" id="form" class="layui-form">
            <table border="0" style="margin-left: 20px;" id="table_manage">
                <tr>
                    <td width="65">客户名称:</td>
                    <td colspan="3">
                        <input type="text" name="cliName" class="inputOne">
                    </td>
                </tr>
                <tr>
                    <td width="65">客户类型:</td>
                    <td width="130">
                        <select lay-filter="business" name="cliType" class="inputTwo" lay-ignore>
                            <option value=""></option>
                        </select>
                        <button type="button" class="clientTypeEditButton"
                                style="width: 23px;height: 23px;display: inline-block;margin-left: -5px;">+
                        </button>
                    </td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                <tr>
                    <td>所属地区:</td>
                    <td colspan="3">
                        <select name="cliProId" id="proName" lay-filter="proName" style="width: 94px;height: 23px;" lay-ignore>
                            <option value=""></option>
                        </select>

                        <select name="cliCitId" id="citName" lay-filter="citName" style="width: 92px;height: 23px;margin-left: 10px;" lay-ignore>
                            <option value=""></option>
                        </select>

                        <select name="cliDisId" id="disName" lay-filter="disName" style="width: 94px;height: 23px;margin-left: 10px;" lay-ignore>
                            <option value=""></option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>性别:</td>
                    <td>
                        <select lay-filter="business" name="cliSex" style="width: 116px;height: 23px;" lay-ignore>
                            <option value="0">男</option>
                            <option value="1">女</option>
                        </select>
                    </td>
                    <td>出生日期:</td>
                    <td><input type="text" name="cliDate" class="layui-input" id="ymd" placeholder="yyyy-mm-dd"
                               style="width: 116px;display: inline-block;height: 25px;border: 1px solid #A9A9A9"></td>
                </tr>
                <tr>
                    <td>联系人:</td>
                    <td>
                        <select lay-filter="business" name="cliContacts" class="inputFour" lay-ignore>
                            <option value=""></option>
                        </select>
                    </td>
                    <td>联系电话:</td>
                    <td><input type="tel" name="cliPhone" class="input"></td>
                </tr>
                <tr>
                    <td>联系地址:</td>
                    <td colspan="3"><input type="text" name="cliAddress" class="inputOne"></td>
                </tr>
                <tr>
                    <td>卡号:</td>
                    <td><input type="text" name="cliCardNumber" class="inputThree"></td>
                    <td>&nbsp;</td>
                    <td><input type="text" name="cliID" class="input" id="cliID" style="display: none"></td>
                </tr>
                <tr>
                    <td colspan="4" style="color: #FF0000;font-size: 12px;">
                        (请输入后台会员编号，或者输入新的卡号将自动创建一个会员)
                    </td>
                </tr>
                <tr>
                    <td>备注:</td>
                    <td colspan="3"><textarea name="cliRemarks" placeholder="请输入内容"
                                              style="width:308px;height: 50px;"></textarea></td>
                </tr>
                <tr>
                    <td>期初应收:</td>
                    <td><input type="text" name="cliReceivableMoney" placeholder="￥0.00" class="input"></td>
                    <td colspan="2">
                        <input type="checkbox" name="cliChecked" lay-skin="primary" value="1"
                               style="vertical-align: middle">
                        <span style="font-size: 15px;margin-left: -11px;vertical-align: middle">默认客户</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4" style="color: #FF0000;font-size: 12px;">
                        (期初应收:新增此客户时，此客户目前欠我方的贷款金额)
                    </td>
                </tr>
                <tr>
                    <td colspan="4"></td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td align="center">
                        <button lay-submit lay-filter="U" id="LAY-component-form-getval"
                                class="layui-btn layui-btn-sm layui-btn-radius">提交
                        </button>
                    </td>
                    <td>&nbsp;</td>
                    <td align="left">
                        <button type="button" class="layui-btn layui-btn-sm layui-btn-radius" id="clientAddClose">退出</button>
                    </td>
                </tr>
            </table>
        </form>
    </div>
</div>
<!--编辑框-->
<div class="layui-row" id="updateClient" style="display: none">
    <div class="layui-col-md11">
        <form lay-filter="formTestFilter2122" id="update" onsubmit="return false" class="layui-form">
            <table border="0" style="margin-left: 20px;">
                <tr>
                    <td width="65">客户名称:</td>
                    <td colspan="3">
                        <input type="text" name="cliName" class="inputOne">
                    </td>
                </tr>
                <tr>
                    <td width="65">客户类型:</td>
                    <td width="130">
                        <select lay-filter="business" name="cliType" id="cltId" class="inputTwo" lay-ignore>
                            <option value=""></option>
                        </select>
                        <button type="button" class="clientTypeEditButton"
                                style="width: 23px;height: 23.1px;display: inline-block;margin-left: -4px;"
                                iass="buttonType">+
                        </button>
                    </td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                <tr>
                    <td>所属地区:</td>
                    <td colspan="3">
                        <select name="cliProId" id="proNameOne" lay-filter="proName" style="width: 94px;height: 23px;" lay-ignore>
                            <option value=""></option>
                        </select>

                        <select name="cliCitId" id="citNameOne" lay-filter="citName" style="width: 92px;height: 23px;margin-left: 10px;" lay-ignore>
                            <option value=""></option>
                        </select>

                        <select name="cliDisId" id="disNameOne" lay-filter="disName" style="width: 94px;height: 23px;margin-left: 10px;" lay-ignore>
                            <option value=""></option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>性别:</td>
                    <td>
                        <select lay-filter="business" name="cliSex" style="width: 116px;height: 23px;" lay-ignore>
                            <option value="0">男</option>
                            <option value="1">女</option>
                        </select>
                    </td>
                    <td>出生日期:</td>
                    <td><input type="text" name="cliDate" class="layui-input" id="ymdOne" placeholder="yyyy-mm-dd"
                               style="width: 116px;display: inline-block;height: 25px;border: 1px solid #A9A9A9"></td>
                </tr>
                <tr>
                    <td>联系人:</td>
                    <td>
                        <select lay-filter="business" name="cliContacts" class="inputFour" lay-ignore>
                            <option value=""></option>
                        </select>
                    </td>
                    <td>联系电话:</td>
                    <td><input type="tel" name="cliPhone" class="input"></td>
                </tr>
                <tr>
                    <td>联系地址:</td>
                    <td colspan="3"><input type="text" name="cliAddress" class="inputOne"></td>
                </tr>
                <tr>
                    <td>卡号:</td>
                    <td><input type="text" name="cliCardNumber" class="inputThree"></td>
                    <td>&nbsp;</td>
                    <td><input type="text" name="cliID" class="input" style="display: none" disabled></td>
                </tr>
                <tr>
                    <td colspan="4" style="color: #FF0000;font-size: 12px;">
                        (请输入后台会员编号，或者输入新的卡号将自动创建一个会员)
                    </td>
                </tr>
                <tr>
                    <td>备注:</td>
                    <td colspan="3"><textarea name="cliRemarks" placeholder="请输入内容"
                                              style="width:308px;height: 50px;"></textarea></td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td colspan="3" align="center">
                        <input type="checkbox" name="cliChecked" lay-skin="primary" value="1"
                               style="vertical-align: middle">
                        <span style="font-size: 15px;margin-left: -11px;vertical-align: middle">默认客户</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="4"></td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td align="center">
                        <button lay-submit lay-filter="U" id="que" id="LAY-component-form-getval1"
                                class="layui-btn layui-btn-sm layui-btn-radius">提交
                        </button>
                    </td>
                    <td>&nbsp;</td>
                    <td align="left">
                        <button type="button" class="layui-btn layui-btn-sm layui-btn-radius" id="clientAddCloseOne">退出</button>
                    </td>
                </tr>
            </table>
        </form>
    </div>
</div>
<div id="clientTypeEidtTab" style="width: 300px;display: none;margin-left: 5px;margin-top: -5px;">
    <div class="layui-tab layui-tab-card">
        <ul class="layui-tab-title">
            <li class="layui-this">客户类型设置</li>
        </ul>
        <div class="layui-tab-content" style="height: 190px;">
            <div class="layui-tab-item layui-show" style="margin-left: -10px;margin-top: -20px;">
                <table class="layui-hide" id="clientTypeTableButton" lay-filter="tests2">

                </table>
                <div style="position: absolute;top: 70px;left: 254px;">
                    <button type="button" class="layui-btn layui-btn-primary layui-btn-sm"
                            style="border-radius: 5px;" id="clientTypeEditAdd">添加
                    </button>
                    <br/><br/>
                    <button type="button" class="layui-btn layui-btn-primary layui-btn-sm"
                            style="border-radius: 5px;" id="clientTypeEditUpdate">修改
                    </button>
                    <br/><br/>
                    <button type="button" class="layui-btn layui-btn-primary layui-btn-sm"
                            style="border-radius: 5px;" id="clientTypeEditDelete">删除
                    </button>
                    <br/><br/>
                    <button type="button" class="layui-btn layui-btn-primary layui-btn-sm"
                            style="border-radius: 5px;" id="clientTypeEditClose">退出
                    </button>
                    <br/><br/>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="clientTypeEdit" style="display: none">
    <form action="" method="post" lay-filter="formTestFilter2123" class="layui-form">
        <table border="0" align="center" style="margin-top: 5px;">
            <!--<tr>
                <td>类型编号:</td>
                <td><input type="text" id="cliId2" name="cltID" style="width: 100px;height: 15px;"></td>
            </tr>-->
            <tr>
                <td>客户类型:</td>
                <td><input type="text" id="cliName2" name="cltName" style="width: 100px;height: 15px;"></td>
            </tr>
            <tr>
                <td><input type="text" id="cliId2" name="cltID" style="width: 100px;height: 15px;display: none"></td>
                <td><input type="checkbox" name="cliChecked" lay-skin="primary" value="1">默认选择</td>
            </tr>
            <tr>
                <td align="center">
                    <button type="button" lay-submit lay-filter="C" class="layui-btn layui-btn-primary layui-btn-xs"
                            style="border-radius: 5px;margin-left: 20px;">确定
                    </button>
                </td>
                <td align="center">
                    <button type="button" class="layui-btn layui-btn-primary layui-btn-xs" id="close"
                            style="border-radius: 5px;">退出
                    </button>
                </td>
            </tr>
        </table>
    </form>
</div>
<script src="layui/layui.all.js?t=1573457678857"></script>
<script src="layui/layui.js?t=1573457678857"></script>
<script>
    var cliTypeadd;
    layui.config({
        version: '1573457678857' //为了更新 js 缓存，可
    });
    layui.use(['laydate', 'table', 'element', 'form', 'layer'], function () {
        var table = layui.table //表格
            , $ = layui.$
            , element = layui.element//元素操作
            , laypage = layui.laypage;//分页
        var form = layui.form;
        var layer = layui.layer;
        //监听Tab切换
        element.on('tab(demo)', function (data) {
            layer.tips('切换了 ' + data.index + '：' + this.innerHTML, this, {
                tips: 1
            });
        });
        layui.use(['layer', 'form'], function () {
            layui.form.render('select');
        });
        //执行一个 table 实例
        table.render({
            elem: '#cliet'
            , height: 540//表单的高
            , width: 1168//表单的宽
            , id: 'idTest'
            , url: '/searchClientMapList.action' //数据接口
            , title: '客户信息表'
            , shade: 0//不显示遮罩
            , page: true //开启分页
            , limits: [10, 20, 50]  //每页条数的选择项，默认：[10,20,30,40,50,60,70,80,90]。
            , limit: 10 //每页默认显示的数量
            /*,method:'post'  //提交方式*/
            , skin: 'line ' //表格风格 line （行边框风格）row （列边框风格）nob （无边框风格）
            , toolbar: 'default' //开启工具栏，此处显示默认图标，可以自定义模板，详见文档true/default
            , totalRow: true //开启合计行
            , cols: [[ //表头
                {type: 'checkbox', fixed: 'left'}//LAY_CHECKED:true默认单选框选中
                , {field: 'cliID', title: '客户编号', width: 120, align: 'center', sort: true, totalRowText: '合计：'}//sort: true排序
                , {field: 'cliName', title: '客户名称', align: 'center', width: 90}
                , {templet: '<div>{{d.employees.empName}}</div>', title: '联系人', align: 'center', width: 90}
                , {field: 'cliPhone', title: '联系电话', align: 'center', width: 120}
                , {
                    field: 'cliReceivableMoney',
                    title: '我方应付金额',
                    width: 180,
                    align: 'center',
                    totalRow: true,
                    sort: true
                }// totalRow: true合计
                , {field: 'cliAddress', title: '联系地址', align: 'center', width: 160}
                , {templet: '<div>{{d.clientType.cltName}}</div>', title: '客户类型', align: 'center', width: 160}
                , {templet: '<div>{{d.province.proName+d.city.citName+d.district.disName}}</div>', title: '所属地区', align: 'center', width: 160}
                , {
                    field: 'cliChecked', title: '默认客户', align: 'center', width: 100, templet: function (row) {
                        var html = "<input type='checkbox' lay-skin='primary' lay-filter='checkboxIsSelected' table-index='" + row.LAY_TABLE_INDEX + "' class='checkboxIsSelected' value='1' ";
                        if (row.cliChecked == 1) {
                            html += " checked ";
                        }
                        html += ">";
                        return html;
                    }
                }
                , {field: 'cliRemarks', align: 'center', title: '备注', width: 180}
                /* , {fixed: 'right', width: 165, align: 'center', toolbar: '#barDemo'}*/
            ]], parseData: function (res, curr, count) { //res 即为原始返回的数据 //curr得到当前页码//count得到数据总量
                return {
                    "code": res.status, //解析接口状态
                    "msg": res.msg, //解析提示文本
                    "count": res.count, //解析数据长度
                    "data": res.row //解析数据列表
                };
            }, done: function (obj) {//复选框函数
                layer.closeAll();
                form.on('checkbox(checkboxIsSelected)', function (data) {
                    var _index = $(data.elem).attr('table-index') || 0;
                    if (data.elem.checked) {
                        obj.data[_index].cliChecked = data.value;
                    } else {
                        obj.data[_index].cliChecked = 2;
                    }
                });
                var clientList = table.cache.js_table_reource_invite_supplier_index_table;

            }
        });

        // $(document).ready(function(){
        //获取客户类型的数据
        $.ajax({
            type: "post",
            url: "/searchClientType2.action",  //从数据库查询返回的是个list
            dataType: "json",
            success: function (checkStatus) {
                // alert(JSON.stringify(checkStatus));
                $.each(checkStatus, function (index, dataVa) {
                    $('.inputTwo').append(new Option(dataVa.cltName, dataVa.cltID));//往下拉菜单里添加元素
                });
                form.render();//菜单渲染 把内容加载进去
            }
        });
        //获取联系人的数据
        $.ajax({
            type: "post",
            url: "/searchEmployees.action",  //从数据库查询返回的是个list
            dataType: "json",
            success: function (checkStatus) {
                // alert(JSON.stringify(checkStatus));
                $.each(checkStatus, function (index, dataVa) {
                    $('.inputFour').append(new Option(dataVa.empName, dataVa.empNo));//往下拉菜单里添加元素
                });
                form.render();//菜单渲染 把内容加载进去
            }
        });

        //监听头工具栏事件
        table.on('toolbar(test)', function (obj) {
            var checkStatus = table.checkStatus(obj.config.id)
                , data = checkStatus.data; //获取选中的数据
            switch (obj.event) {
                case 'add':
                    $(function () {
                        $('#clientTypeEditAdd').click(function (l) {
                            cliTypeadd = layer.open({
                                //layer提供了5种层类型。可传入的值有：0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                                type: 1,
                                closeBtn: 2,
                                area: ['200px', '160px'],// $('#id')
                                title:'新增客户类型信息',
                                content: $('#clientTypeEdit'),
                                skin: 'demo-class',
                                success: function (layero, index) {
                                    $('#clientTypeEdit').css({"display": "block"});
                                    $('#close').click(function () {
                                        layer.close(cliTypeadd);
                                    });
                                    console.log(layero, index);
                                    $.ajax({
                                        type: "post",
                                        url: "/returnClientTypeId.action",
                                        success: function (data) {
                                            var textId = $("#cliId2");//根据文本框的id找到这个文本框，并将其变成jquery对象
                                            textId.val(data);
                                        }
                                    });
                                    /*新增客户类型*/
                                    form.on('submit(C)', function (data) {

                                        //var dataValue = data.field;//当前容器的全部表单字段，名值对形式：{name: value}
                                        data = form.val('formTestFilter2123');
                                        var dataVa = JSON.stringify(data);
                                        $.ajax({
                                            type: "post"//请求提交方式,
                                            , url: "/clientTypeInsert.action"
                                            , data: dataVa
                                            , dataType: "JSON"
                                            // ,async: false
                                            , contentType: "application/json;charset=UTF-8"
                                            , success: function (checkStatus) {
                                                layer.close(cliTypeadd)
                                                table.reload('cltType');//刷新，更新数据
                                                form.render();
                                            }
                                        });
                                        return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
                                    }, function (data) {//回调函数
                                        alert(JSON.stringify(data));
                                    });
                                }
                            });
                        });
                            $('#clientTypeEditUpdate').click(function (l) {
                                var checkStatus = table.checkStatus('cltType'); //idTest 即为基础参数 id 对应的值
                                $("#cliId2").val(checkStatus.data[0].cltID);
                                $("#cliName2").val(checkStatus.data[0].cltName);
                                var cliTypeadd = layer.open({
                                    //layer提供了5种层类型。可传入的值有：0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                                    type: 1,
                                    closeBtn: 2,
                                    title:'修改客户类型信息',
                                    area: ['200px', '160px'],// $('#id')
                                    content: $('#clientTypeEdit'),
                                    skin: 'demo-class',
                                    shade: 0,
                                    success: function (layero) {
                                        $('#clientkeTypeEdit').css({"display": "block"});
                                        $('#close').click(function () {
                                            layer.close(cliTypeadd);
                                        });
                                    }
                                });
                                /*编辑客户类型*/
                                form.on('submit(C)', function (data) {
                                    window.alert(JSON.stringify(data.cliName));
                                    //var dataValue = data.field;//当前容器的全部表单字段，名值对形式：{name: value}
                                    data = form.val('formTestFilter2123');
                                    var dataVa = JSON.stringify(data);
                                    $.ajpax({
                                        type: "post"//请求提交方式,
                                        , url: "/clientTypeUpdate.action"
                                        , data: dataVa
                                        , dataType: "JSON"
                                        // ,async: false
                                        , contentType: "application/json;charset=UTF-8"
                                        , success: function (checkStatus) {
                                            table.reload('cltType');//刷新，更新数据
                                            form.render();
                                        }
                                    });
                                    layer.close(cliTypeadd);
                                    return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
                                }, function (data) {//回调函数

                                });
                            });

                            $('#clientTypeEditDelete').click(function () {
                                var checkStatus = table.checkStatus('cltType'); //idTest 即为基础参数 id 对应的值
                                console.log(checkStatus.data);
                                for(var i = 0;i<checkStatus.data.length;i++){
                                    $.ajax({
                                        type: "post"//请求提交方式,
                                        , url: "/clientTypeDelete.action?cltID=" + checkStatus.data[i].cltID
                                        , dataType: "JSON"
                                        // ,async: false
                                        , contentType: "application/json;charset=UTF-8"
                                        , success: function (checkStatus) {
                                            layer.close(cliTypeadd)
                                            table.reload('cltType');//刷新，更新数据
                                            //重载数据*/
                                            form.render();
                                        }
                                    })
                                }
                            });
                        });
                    $.ajax({
                        type:"POST",
                        url:'/warehouseManager/warehouseAllprovince.action',  //从数据库查询返回的是个list
                        dataType: "json",
                        success: function (data) {
                            //window.alert(JSON.stringify(data));
                            $.each(data,function(index,item){
                                $('#proName').append(new Option(item.proName,item.proId));//往下拉菜单里添加元素
                            });
                            form.render();
                        }
                    });
                    $("#proName").change(function () {
                        $("#citName").html("");
                        $("#disName").html("");
                        var checkred=JSON.stringify($("#proName option:selected").val());
                        $.ajax({
                            type:"POST",
                            url:'/warehouseManager/warehouseAllCity.action?processId='+checkred,  //从数据库查询返回的是个list
                            dataType: "json",
                            success: function (data) {
                                $.each(data,function(index,item){
                                    $('#citName').append(new Option(item.citName,item.citId));//往下拉菜单里添加元素
                                });
                                form.render();
                            }
                        })
                    });
                    $("#citName").change(function () {
                        $("#disName").html("");
                        var checkrede=$("#citName option:selected").val();
                        $.ajax({
                            type:"POST",
                            url:'/warehouseManager/warehouseAllArea.action?cityId='+checkrede,  //从数据库查询返回的是个list
                            dataType: "json",
                            success: function (data1) {
                                $.each(data1,function(index,item){
                                    $('#disName').append(new Option(item.disName,item.disId));//往下拉菜单里添加元素
                                });
                                form.render();
                            }
                        })
                    });
                    //客户主键自增
                    $.ajax({
                        type: "post",
                        url: "/returnClientId.action",
                        success: function (data) {
                            var textId = $("#cliID");//根据文本框的id找到这个文本框，并将其变成jquery对象
                            textId.val(data);
                        }
                    });
                    /*layer.msg('添加');*/
                    var index1 = layer.open({
                        //layer提供了5种层类型。可传入的值有：0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                        type: 1,
                        /*moveOut: false,*///弹出框是否可以移出
                        shade: 0,//不显示遮罩
                        title: "新增客户信息",
                        area: ['431px', '520px'],//增加框的宽高
                        content: $('#addClient'),// $('#id')
                        skin: 'demo-class',//自定义样式风格

                    });
                    layer.close(//当单击新增按钮表单数据清空
                        $('#form')[0].reset()
                    );
                    //退出按钮
                    $('#clientAddClose').click(function () {
                        layer.close(index1);
                    });
                    //禁止表单自带的提交方式进行提交(返回false)
                    form.on('submit(formTestFilter2121)', function (data) {
                        return false;
                    });

                    $("#LAY-component-form-getval").click(function () {
                        var data = form.val('formTestFilter2121');
                        var dataVa = JSON.stringify(data);
                        var citId=$("#citName option:selected").val();
                        var proId=$("#proName option:selected").val();
                        var disId=$("#disName option:selected").val();
                        $.ajax({
                            type: "post"//请求提交方式,
                            , url: "/clientInsert.action?proId=\"+proId+\"&citId=\"+citId+\"&disId=\"+disId"
                            , data: dataVa
                            , dataType: "JSON"
                            // ,async: false
                            , contentType: "application/json;charset=UTF-8"
                            , success: function (checkStatus) {
                                layer.close(index1);//关闭窗口
                                table.reload('idTest');//刷新，更新数据
                                form.render();
                            }
                        });
                        location.reload();
                    });
                    form.on('submit(U)', function (data) {
                        //var dataValue = data.field;//当前容器的全部表单字段，名值对形式：{name: value}
                        return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
                    }, function (data) {//回调函数
                        //alert(JSON.stringify(data));
                    });

                    break;
                case 'update':
                    if (data.length === 0) {
                        layer.msg('请选择一行');
                    } else if (data.length > 1) {
                        layer.msg('只能同时编辑一个');
                    } else {
                        $.ajax({
                            type:"POST",
                            url:'/warehouseManager/warehouseAllprovince.action',  //从数据库查询返回的是个list
                            dataType: "json",
                            success: function (data3) {
                                $.each(data3,function(index,item){
                                    $('#proNameOne').append(new Option(item.proName,item.proId));//往下拉菜单里添加元素
                                    if(checkStatus.data[0].cliProId==item.proId){
                                        $('#proNameOne').val(checkStatus.data[0].cliProId)
                                    }
                                });
                                var checkred=JSON.stringify(data[0].cliProId);
                                $.ajax({
                                    type:"POST",
                                    url:'/warehouseManager/warehouseAllCity.action?processId='+checkred,  //从数据库查询返回的是个list
                                    dataType: "json",
                                    success: function (data1) {
                                        $.each(data1,function(index1,item1){
                                            $('#citNameOne').append(new Option(item1.citName,item1.citId));//往下拉菜单里添加元素
                                            if(checkStatus.data[0].cliCitId==item1.citId){
                                                $('#citNameOne').val(checkStatus.data[0].cliCitId)
                                            }
                                        });
                                        //form.render();
                                        var checkrede2=$("#citNameOne option:selected").val();
                                        $.ajax({
                                            type:"POST",
                                            url:'/warehouseManager/warehouseAllArea.action?cityId='+checkrede2,  //从数据库查询返回的是个list
                                            dataType: "json",
                                            success: function (data2) {
                                                $.each(data2,function(index2,item2){
                                                    $('#disNameOne').append(new Option(item2.disName,item2.disId));//往下拉菜单里添加元素
                                                    if(checkStatus.data[0].cliDisId==item2.disId){
                                                        $('#disNameOne').val(checkStatus.data[0].cliDisId)
                                                    }
                                                });
                                                // $("#disNameOne").val(data[0].disNo);
                                            }
                                        })

                                    }
                                });
                                form.render();
                            }
                        });
                        form.render();

                        $.ajax({
                            type:"POST",
                            url:'/warehouseManager/warehouseAllprovince.action',  //从数据库查询返回的是个list
                            dataType: "json",
                            success: function (data) {
                                $("#proNameOne").change(function () {
                                    $('#proNameOne').html("");
                                    $("#citNameOne").html("");
                                    $("#disNameOne").html("");
                                    $.each(data,function(index,item){
                                        console.log(checkStatus.data[0].cliProId);
                                        $('#proNameOne').append(new Option(item.proName,item.proId));//往下拉菜单里添加元素
                                        if(checkStatus.data[0].cliProId==item.proId){
                                            $('#proNameOne').val(checkStatus.data[0].cliProId)
                                        }
                                    });
                                });
                            }
                        });

                        $("#proNameOne").change(function () {
                            $("#citNameOne").html("");
                            $("#disNameOne").html("");
                            var checkred=JSON.stringify($("#proNameOne option:selected").val());
                            $.ajax({
                                type:"POST",
                                url:'/warehouseManager/warehouseAllCity.action?processId='+checkred,  //从数据库查询返回的是个list
                                dataType: "json",
                                success: function (data) {
                                    $.each(data,function(index,item){


                                        $('#citNameOne').append(new Option(item.citName,item.citId));//往下拉菜单里添加元素
                                    });
                                }
                            })
                        });

                        $("#citNameOne").change(function () {
                            $("#disNameOne").html("");
                            var checkrede=$("#citNameOne option:selected").val();
                            //alert(checkrede);
                            //var bb=$("#citName").val();
                            //alert(bb);
                            $.ajax({
                                type:"POST",
                                url:'/warehouseManager/warehouseAllArea.action?cityId='+checkrede,  //从数据库查询返回的是个list
                                dataType: "json",
                                success: function (data1) {
                                    $.each(data1,function(index,item){
                                        $('#disNameOne').append(new Option(item.disName,item.disId));//往下拉菜单里添加元素
                                    });
                                }
                            })

                        });

                        //修改退出按钮
                        $('#clientAddCloseOne').click(function () {
                            layer.close(indexUpdate);
                        });

                        var indexUpdate = layer.open({
                            //layer提供了5种层类型。可传入的值有：0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                            type: 1,
                            //closeBtn: 2,//×的样式
                            shade: 0,//不显示遮罩
                            title: "编辑客户信息",
                            area: ['431px', '500px'],//增加框的宽高
                            content: $('#updateClient'),// $('#id')
                            skin: 'demo-class',//自定义样式风格
                            success: function (layero, index) {//JQ函数
                                $('#updateClient').css({"display": "block"});
                                form.on('submit(U)', function (data) {
                                    data = form.val('formTestFilter2122');
                                    var dataVa = JSON.stringify(data);
                                    // alert(JSON.stringify(data));
                                    $.ajax({
                                        type: "post"//请求提交方式,
                                        , url: "/clientUpdate.action"
                                        , data: dataVa
                                        , contentType: "application/json;charset=UTF-8"
                                        , success: function (checkStatus) {
                                            layer.close(index);//关闭窗口
                                            table.reload('idTest');//刷新，更新数据
                                            //window.alert('编辑成功 ');
                                            form.render();
                                        }
                                    });
                                    return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
                                });
                            },
                        });

                        //cliProId,cliCitId,cliDisId
                        var numbers = $("#cltId option");
                        for (var j = 1; j < numbers.length; j++) {
                            if (checkStatus.data[0].clientType.cltID == numbers[j].value) {
                                $("#cltId").val(checkStatus.data[0].clientType.cltID);
                                break;
                            }
                        }
                        //表单赋值：为编辑中的表单添加数据库中的数据
                        form.val('formTestFilter2122',{
                            "cliID": checkStatus.data[0].cliID
                            , "cliName": checkStatus.data[0].cliName
                            , "cliSex": checkStatus.data[0].cliSex
                            , "cliContacts": checkStatus.data[0].cliContacts
                            , "cliPhone": checkStatus.data[0].cliPhone
                            , "cliReceivableMoney": checkStatus.data[0].cliReceivableMoney
                            , "cliAddressNo": checkStatus.data[0].cliAddressNo
                            , "cliAddress": checkStatus.data[0].cliAddress
                            , "clientType": checkStatus.data[0].clientType
                            , "cliDate": checkStatus.data[0].cliDate
                            , "cliArea": checkStatus.data[0].cliArea
                            , "cliCardNumber": checkStatus.data[0].cliCardNumber
                            , "cliChecked": checkStatus.data[0].cliChecked
                            , "cliRemarks": checkStatus.data[0].cliRemarks
                        });
                        // table.reload();
                    }
                    break;
                case 'delete':
                    if (data.length === 0) {
                        layer.msg('请选择一行');
                    } else {
                        layer.open({
                            content: '是否确认删除！',
                            yes: function (index, layero) {
                                var checkStatus = table.checkStatus('idTest');
                                //获取被选中的行，对数组进行处理
                                var isCheckred=checkStatus.data;
                                var cliIdStr="";
                                for(var i=0;i<isCheckred.length;i++){
                                    var cliID = isCheckred[i].cliID;
                                    cliIdStr+=cliID;
                                    if(i != isCheckred.length - 1){
                                        cliIdStr+=",";
                                    }
                                }
                                //alert(cliIdStr);
                                $.ajax({
                                    type: "post",
                                    url: '/clientDelete.action',
                                    data: 'cliID='+cliIdStr,
                                    dataType: "text",
                                    success: function (data) {

                                        location.reload();
                                    }
                                });
                                //定义一次性删除多条数据
                            }
                        });
                    }
                    break;
            }
        });

        layui.use('laydate', function () {
            var laydate = layui.laydate;

            //执行一个laydate实例
            laydate.render({
                elem: '#ymd', //指定元素
                theme: 'molv',
                max: getNowFormatDate()
            });
            laydate.render({
                elem: '#ymdOne', //指定元素
                theme: 'molv',
                max: getNowFormatDate()
            });
        });

        //防止出生日期大于系统的当前时间
        function getNowFormatDate() {
            var date = new Date();
            var seperator1 = "-";
            var seperator2 = ":";
            var month = date.getMonth() + 1;
            var strDate = date.getDate();
            if (month >= 1 && month <= 9) {
                month = "0" + month;
            }
            if (strDate >= 0 && strDate <= 9) {
                strDate = "0" + strDate;
            }
            var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
                + " " + date.getHours() + seperator2 + date.getMinutes()
                + seperator2 + date.getSeconds();
            return currentdate;
        }

        $(function () {
            $('.clientTypeEditButton').click(function () {
                var cliTypeEdit = layer.open({
                    //layer提供了5种层类型。可传入的值有：0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                    type: 1,
                    closeBtn: 2,
                    title: "基本资料设置",
                    area: ['310px', '310px'],
                    content: $('#clientTypeEidtTab'),
                    skin: 'demo-class',
                    success: function (layero, index) {
                        $('#clientTypeEidtTab').css({"display": "block"});
                        $('#clientTypeEditClose').click(function () {
                            layer.close(cliTypeEdit);
                        });
                        console.log(layero, index);
                    }
                });
            });
        });
        layui.use('table', function () {
            var table = layui.table;
            table.render({
                elem: '#clientTypeTableButton'
                , url: '/searchClientType.action'
                , width: 242
                , height: 210
                , id: 'cltType'
                , cols: [[
                    {type: 'checkbox', fixed: 'left'}
                    , {field: 'cltID', title: '客户类型ID', align: 'center', width: 100}
                    , {field: 'cltName', title: '客户类型', align: 'center', width: 90}
                ]], parseData: function (res, curr, count) { //res 即为原始返回的数据 //curr得到当前页码//count得到数据总量
                    //window.alert(res.row)
                    return {
                        "code": 0, //解析接口状态
                        "msg": res.msg, //解析提示文本
                        "count": res.count, //解析数据长度
                        "data": res.row //解析数据列表
                    };
                }
            });
        });

    })
</script>
</body>
</html>
