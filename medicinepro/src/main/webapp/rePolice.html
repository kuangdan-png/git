<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>库存报警</title>
    <link rel="stylesheet" href="../layui/css/layui.css">
    <style type="text/css">
        .layedit-tool-ul li{
            display: inline-block;
            margin: 14px;
            margin-top: 5px;
            width: 62px;
            height: 56px;
        }
        .layedit-tool-li i{
            position: relative;
            left: 10px;
        }
        .layeli{
              position: relative;
              left: 16px;
          }
        #tables1,#tables2{
            display: none;
        }
    </style>
</head>
<body style="width: 1150px;margin: 5px ;height:550px;border:1px solid black;">
    <!--表格-->
    <table class="layui-hide" id="test5" lay-filter="layui-test01"></table>

    <div>
        <center>
        进货销售明细：
            <!--时间-->
            查询日期：
            <input type="text" style="width: 100px" id="test1" >
            至
            <input type="text" style="width: 100px" id="test2" >
            <!--按钮-->
            <button type="button" class="layui-btn" style="background:#C1CEE8;color: #03206C; border:2px;border-radius: 25px;height:26px;line-height: 20px;margin-left: 20px;" id="search">查询</button>
            <button type="button" class="layui-btn" style="background:#C1CEE8;color: #03206C; border:2px;border-radius: 25px;height:26px;line-height: 20px;margin-left: 20px;">查看单据</button>
        </center>
        <!--表格-->
        <table class="layui-hide" id="test"></table>
    </div>

    <!--修改商品弹出层-->
    <div id="tables1">
        <div style="border:1px rgba(0,0,0,0.2) solid;width: 480px;margin-left: 10px;border-radius: 5px;">
            <p style="margin-top: 10px;"><span style="margin-left:10px;">所属类别：<input type="text" style="width: 140px;" ></span>
                <span style="margin-left:35px;">商品编号：<input type="text" style="width: 140px;"></span></p>
            <p style="margin-top: 10px;"><span style="margin-left:10px;">商品名称：<input type="text" style="width: 140px;" ></span>
                <span style="margin-left:35px;">商品条码：<input type="text" style="width: 140px;"></span></p></p>
            <p style="margin-top: 10px;"><span style="margin-left:10px;">名称简拼：<input type="text" style="width: 140px;" ></span>
                <span style="margin-left:35px;">单&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  位：<input type="text" style="width: 140px;"></span></p></p>
            <p style="margin-top: 10px;"><span style="margin-left:10px;">产品规格：<input type="text" style="width: 140px;" ></span>
                <span style="margin-left:35px;">药剂类型：<input type="text" style="width: 140px;"></span></p></p>
            <p style="margin-top: 10px;"><span style="margin-left:10px;">预设售价：<input type="text" style="width: 140px;" ></span>
                <span style="margin-left:35px;">预设进价：<input type="text" style="width: 140px;"></span></p></p>
            <p style="margin-top: 10px;"><span style="margin-left:10px;">库存下限：<input type="text" style="width: 140px;" ></span>
                <span style="margin-left:35px;">保 &nbsp;质 &nbsp;期：<input type="text" style="width: 100px;"></span> 个 月</p></p>
            <p style="margin-top: 10px;"><span style="margin-left:10px;">通 &nbsp;用 &nbsp;名：<input type="text" style="width: 140px;" ></span>
                <span style="margin-left:35px;">批准文号：<input type="text" style="width: 140px;"></span></p></p>
            <p style="margin-top: 10px;"><span style="margin-left:10px;">生产厂商：<input type="text" style="width:350px;" ></span></p>
            <p style="margin-top: 10px;"><span style="margin-left:10px;">备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  注：<input type="text" style="width:350px;" ></span></p>
            <p style="margin-top: 10px;"><span style="margin-left:10px;"><input type="checkbox">该商品可拆零   &nbsp;&nbsp;拆零系数;<input type="text" placeholder="¥0.00" style="width: 60px"><span style="color: red">拆零系数是该商品拆零后的个数</span></span></p>
            <!--选项卡-->
            <div class="layui-tab">
                <ul class="layui-tab-title">
                    <li class="layui-this">GSP属性设置</li>
                    <li>特价、提成设置</li>
                </ul>
                <div class="layui-tab-content">
                    <!--内容1-->
                    <div class="layui-tab-item layui-show">
                        <p style="margin-top: 10px;"><span style="margin-left:10px;">养护方式：<input type="text" placeholder="常规养护" style="width: 60px"></span>
                            <span style="margin-left:65px;">GSP验收属性：<input type="text" style="width: 140px;"></span></p>
                        <p style="margin-top: 10px;"><span style="margin-left:10px;">存储条件：<input type="text" style="width: 60px"></span>
                            <span style="margin-left:94px;">注册证号：<input type="text" style="width: 140px;"></span></p>
                        <p style="margin-top: 10px;margin-left:13px;"><input type="checkbox">电子监管  <input type="checkbox" style="margin-left:90px;">含麻黄碱 <input type="checkbox" style="margin-left: 90px;">处方药</p>
                        <p style="margin-top: 10px;margin-left:13px;"><input type="checkbox">特殊药品<input type="checkbox" style="margin-left: 150px;">口服药，一月的剂量限制<input type="text" style="width: 30px;" placeholder="0"></p>
                    </div>
                    <!--内容2-->
                    <div class="layui-tab-item">
                        <p style="margin-top: 10px;"><span style="margin-left:10px;"><input type="checkbox">商品特价：<input type="text" placeholder="¥0.00" style="width: 80px"></span>
                            <span style="margin-left:35px;"><input type="checkbox">会员特价：<input type="text" placeholder="¥0.00"  style="width: 140px;"></span></p>
                        <p style="margin-top: 10px;"><span style="margin-left:10px;"><input type="checkbox">期限开始：<input type="text" style="width: 80px" placeholder="2019-11-25"></span>
                            <span style="margin-left:48px;">限期结束：<input type="text" style="width:140px" placeholder="2019-11-25"></span></p>
                        <p style="margin-top: 10px;margin-left:23px;">销售提成：  <input type="text" placeholder="¥0.00" style="width: 80px">元<span style="color:blue;">(指销售本商品，给业务员的提成)</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--自动提醒弹出层-->
    <div id="tables2">
        <!--导航-->
        <div >
            <ul class="layedit-tool-ul">
                <li>
                    <div id="layerDemo2">
                        <span class="layeli layui" data-method="offset" data-type="auto">
                            <i class="layui-icon layui-icon-add-circle-fine" style="font-size: 30px; color: #000000;"></i>
                            </br>增加
                        </span>
                    </div>
                </li>
                <li>
                    <span class="layeli">
                        <i class="layui-icon layui-icon-survey" style="font-size: 30px; color: #000000;"></i>
                        </br>修改
                    </span>
                </li>
                <li class="layedit-tool-li">
                    <span>
                        <i class="layui-icon layui-icon-close" style="font-size: 30px; color: red;"></i>
                        </br>删除商品
                    </span>
                </li>
                <li>
                    <span class="layeli">
                        <i class="layui-icon layui-icon-close-fill" style="font-size: 30px; color: red;"></i>
                        </br>退出
                    </span>
                </li>
            </ul>
        </div>
        <div style="background: #EBEBEB;height: 45px;line-height: 45px;margin-top: -12px">
            <p style="margin-left:10px ;">请选择时间段：<input type="text" id="test4" placeholder="yyyy-MM-dd" style="width: 58px;">至：<input type="text" id="test6"  style="width: 58px;" placeholder="yyyy-MM-dd">
                请选择相关内容进行查询:<input type="text" style="width: 80px;"><button type="button" class="layui-btn" style="background:#C1CEE8;color: #03206C; border:2px;border-radius: 25px;height:26px;line-height: 20px;">查询(F2)</button></p>
        </div>
        <div>
            <table class="layui-hide" id="testt"></table>
        </div>
    </div>

<script src="layui/layui.js"></script>
<script>
    var tableData = null;
    //表格
    layui.use(['table','form'],function(){
        var table = layui.table;
        var form = layui.form;
        var $ = layui.jquery;
        table.render({
            elem: '#test5'
            ,url:'/wareHouseManager/searchWarehouseNumIsZero.action'
            ,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
            ,totalRow: true
            ,toolbar:'#divTool'
            ,cols: [[
                {type:'checkbox'}
                ,{field:'comId', title: '商品编号', width:100,"LAY_CHECKED":true,sort: true}
                ,{field:'comName', title: '商品名称', width:110, sort: true}
                ,{field:'comUnit', title: '单位', width:80, sort: true}
                ,{field:'comProduct', title: '产品规格', width:100, sort: true}
                ,{field:'comQuality', templet: "<div>{{layui.util.toDateString(d.comQuality, 'yyyy-MM-dd HH:mm:ss')}}</div>",title: '有效期至', width:150, sort: true}
                ,{field:'manName', templet:'<div>{{d.manufacturer.manName}}</div>', title: '生产厂商', width:150, sort: true}
                ,{field:'comPrice', title: '单价', sort: true}
                ,{templet:'<div>{{d.repertorySon.reqCurrent}}</div>', width: 100, title: '库存数量', sort: true}
                ,{field:'comMinKuNumber', title: '最低库存'}
            ]], response: {
                statusCode: 200 //重新规定成功的状态码为 200，table 组件默认为 0
            }, parseData: function (res) { //将原始数据解析成 table 组件所规定的数据
                return {
                    "code": res.status, //解析接口状态
                    "msg": res.msg, //解析提示文本
                    "count": res.count, //解析数据长度
                    "data": res.row//解析数据列表
                };
            },height:320
            , page: true //开启分页
            , limits:[5,10,15,20]
        });
        //单击行选中复选框，有且只能选中一行
        $(document).on("click", ".layui-table-body table.layui-table tbody tr td", function () {
            var objs = $($(this).parent()).siblings();
            $.each(objs,function(i,item){
                if ($(item).find('.layui-form-checked').length > 0) {
                    $(item).find("[data-field='0']").find('i').click();
                }
            })
            if ($(this).attr("data-field") === "0") return;
            $(this).siblings().eq(0).find('i').click();
        });

        $(document).on("click",".layui-table-body table.layui-table tbody tr",function(){
            var obj = event ? event.target : event.srcElement;
            var tag = obj.tagName;
            var checkbox = $(this).find("td div.laytable-cell-checkbox div.layui-form-checkbox I");
            if(checkbox.length!=0){
                if(tag == 'DIV') {
                    checkbox.click();
                }
            }
        });
        $(document).on("click","td div.laytable-cell-checkbox div.layui-form-checkbox",function(e){
            e.stopPropagation();
        });
        //点击查询按条件查询
        $('#search').click(function () {
            //根据id获取上面表格被选中的行
            var checkStatus = table.checkStatus('test5');
            //选中行的数据
            var data = checkStatus.data;
            //选中行的长度
            var isChecked = data.length;
            //一次只能按条件查询一行
            if(isChecked == 1) {
                var  comId = data[0].comId;
                var startTime = $('#test1').val();
                var endTime = $('#test2').val();
                //alert(comId + " " + startTime + " " + endTime);
                table.render({
                    elem: '#test'
                    , url: '/wareHouseManager/searchPurchaseAndSalesDetails.action'
                    , where: {redProcutsNo: comId, duo1: startTime, duo2: endTime}
                    , cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
                    , cols: [[
                        {
                            templet: "<div>{{layui.util.toDateString(d.receiptsDetailed.redDate, 'yyyy-MM-dd HH:mm:ss')}}</div>"
                            , width: 160, title: '日期', sort: true
                        }
                        , {templet: '<div>{{d.receiptsDetailed.redOdd}}</div>', width: 150, title: '单据号'}
                        , {templet: '<div>{{d.receiptstype.retName}}</div>', title: '说明', sort: true}
                        , {field: 'duo1', width: 100, title: '供货商/客户'}
                        , {templet: '<div>{{d.receiptsDetailed.duo6}}</div>', title: '入库数'}
                        , {templet: '<div>{{d.receiptsDetailed.duo7}}</div>', title: '出库数'}
                        , {templet: '<div>{{d.warehouse.warName}}</div>', title: '仓库名', sort: true}
                        , {templet: '<div>{{d.employees.empName}}</div>', title: '经办人'}
                        , {field: 'classify', title: '操作员'}
                    ]], response: {
                        statusCode: 200 //重新规定成功的状态码为 200，table 组件默认为 0
                    }, parseData: function (res) { //将原始数据解析成 table 组件所规定的数据
                        return {
                            "code": res.status, //解析接口状态
                            "msg": res.msg, //解析提示文本
                            "count": res.count, //解析数据长度
                            "data": res.row//解析数据列表
                        };
                    },height:420
                    , page: true //开启分页
                    , limits:[5,10,15,20]
                });
            }else if(isChecked > 1){
                layer.msg("只能选中一行");
            }else{
                layer.msg("请选择");
            }
        })
        table.on('row(layui-test01)',function(obj){
            //获取当前行第二列单元格的值，第一列为复选框
            var comId = $(this).children('td:eq(1)').text();
            //获取开始时间
            var startTime = $('#test1').val();
            //获取结束时间
            var endTime = $('#test2').val();
            //alert(comId + " " + startTime + " " + endTime);
            //重新加载表格
            table.render({
                elem: '#test'
                , url: '/wareHouseManager/searchPurchaseAndSalesDetails.action'
                //注意参数
                , where: {redProcutsNo: comId, duo1: startTime, duo2: endTime}
                , cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
                , cols: [[
                    {
                        templet: "<div>{{layui.util.toDateString(d.receiptsDetailed.redDate, 'yyyy-MM-dd HH:mm:ss')}}</div>"
                        , width: 160, title: '日期', sort: true
                    }
                    , {templet: '<div>{{d.receiptsDetailed.redOdd}}</div>', width: 150, title: '单据号'}
                    , {templet: '<div>{{d.receiptstype.retName}}</div>', title: '说明', sort: true}
                    , {field: 'duo1', width: 100, title: '供货商/客户'}
                    , {templet: '<div>{{d.receiptsDetailed.duo6}}</div>', title: '入库数'}
                    , {templet: '<div>{{d.receiptsDetailed.duo7}}</div>', title: '出库数'}
                    , {templet: '<div>{{d.warehouse.warName}}</div>', title: '仓库名', sort: true}
                    , {templet: '<div>{{d.employees.empName}}</div>', title: '经办人'}
                    , {field: 'classify', title: '操作员'}
                ]], response: {
                    statusCode: 200 //重新规定成功的状态码为 200，table 组件默认为 0
                }, parseData: function (res) { //将原始数据解析成 table 组件所规定的数据
                    return {
                        "code": res.status, //解析接口状态
                        "msg": res.msg, //解析提示文本
                        "count": res.count, //解析数据长度
                        "data": res.row//解析数据列表
                    };
                }, page: true //开启分页
                , limits:[5,10,15,20]

            });
        })

        //第一次进入时，加载表格，不带参数，无数据显示
        table.render({
            elem: '#test'
            , url: '/wareHouseManager/searchPurchaseAndSalesDetails.action'
            , cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
            , cols: [[
                {
                    templet: "<div>{{layui.util.toDateString(d.receiptsDetailed.redDate, 'yyyy-MM-dd HH:mm:ss')}}</div>"
                    , width: 160, title: '日期', sort: true
                }
                , {templet: '<div>{{d.receiptsDetailed.redOdd}}</div>', width: 150, title: '单据号'}
                , {templet: '<div>{{d.receiptstype.retName}}</div>', title: '说明', sort: true}
                , {field: 'duo1', width: 100, title: '供货商/客户'}
                , {templet: '<div>{{d.receiptsDetailed.duo6}}</div>', title: '入库数'}
                , {templet: '<div>{{d.receiptsDetailed.duo7}}</div>', title: '出库数'}
                , {templet: '<div>{{d.warehouse.warName}}</div>', title: '仓库名', sort: true}
                , {templet: '<div>{{d.employees.empName}}</div>', title: '经办人'}
                , {field: 'classify', title: '操作员'}
            ]],response: {
                statusCode: 200 //重新规定成功的状态码为 200，table 组件默认为 0
            },parseData: function (res) { //将原始数据解析成 table 组件所规定的数据
                return {
                    "code": res.status, //解析接口状态
                    "msg": res.msg, //解析提示文本
                    "count": res.count, //解析数据长度
                    "data": res.row//解析数据列表
                };
            }, page: true //开启分页
            , limits:[5,10,15,20]
        });
        table.render({
            elem: '#testt'
            ,url:'/demo/table/user/'
            ,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
            ,cols: [[
                {field:'id', width:80, title: '提醒时间', sort: true}
                ,{field:'username', width:80, title: '提醒方式'}
                ,{field:'sex', width:80, title: '提醒对象', sort: true}
                ,{field:'city', width:80, title: '提醒内容'}
                ,{field:'sign', title: '状态'} //minWidth：局部定义当前单元格的最小宽度，layui 2.2.1 新增
                ,{field:'experience', title: '操作员', sort: true}
            ]]
        });
    });
    //弹出库存批次层
    layui.use('layer', function(){ //独立版的layer无需执行这一句
        var $ = layui.jquery, layer = layui.layer; //独立版的layer无需执行这一句
        //触发事件
        var active = {
            offset: function(othis){
                var type = othis.data('type')
                    ,text = othis.text();
                layer.open({
                    type: 1
                    ,title:'修改商品'
                    ,offset: type //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
                    ,area: ['500px', '605px']
                    ,id: 'layerDemo1'+type //防止重复弹出
                    ,content:$('#tables1')
                    ,btn: ['保存','退出']
                    ,btnAlign: 'c' //按钮居中
                    ,shade: 0 //不显示遮罩
                    ,yes: function(){
                        layer.closeAll();
                    }
                });
            }
        };
        $('#layerDemo .layui').on('click', function(){
            var othis = $(this), method = othis.data('method');
            active[method] ? active[method].call(this, othis) : '';
        });
    });
    //弹出自动提醒层
    layui.use('layer', function(){ //独立版的layer无需执行这一句
        var $ = layui.jquery, layer = layui.layer; //独立版的layer无需执行这一句
        //触发事件
        var active = {
            offset: function(othis){
                var type = othis.data('type')
                    ,text = othis.text();
                layer.open({
                    type: 1
                    ,title:'时间提醒管理'
                    ,offset: type //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
                    ,area: ['600px', '405px']
                    ,id: 'layerDemo1'+type //防止重复弹出
                    ,content:$('#tables2')
                    ,btnAlign: 'c' //按钮居中
                    ,shade: 0 //不显示遮罩
                    ,yes: function(){
                        layer.closeAll();
                    }
                });
            }
        };
        $('#layerDemo1 .layui').on('click', function(){
            var othis = $(this), method = othis.data('method');
            active[method] ? active[method].call(this, othis) : '';
        });
    });

    //选项卡
    layui.use('element', function(){
        var element = layui.element;

        //获取hash来切换选项卡，假设当前地址的hash为lay-id对应的值
        var layid = location.hash.replace(/^#test1=/, '');
        element.tabChange('test1', layid); //假设当前地址为：http://a.com#test1=222，那么选项卡会自动切换到“发送消息”这一项

        //监听Tab切换，以改变地址hash值
        element.on('tab(test1)', function(){
            location.hash = 'test1='+ this.getAttribute('lay-id');
        });
    });
    //时间
    layui.use('laydate', function(){
        var laydate = layui.laydate;

        //执行一个laydate实例
        laydate.render({
            elem: '#test1' //指定元素
            ,value:new Date()
        });
        //执行一个laydate实例
        laydate.render({
            elem: '#test2' //指定元素
            ,value:new Date()
        });
        //执行一个laydate实例
        laydate.render({
            elem: '#test3' //指定元素
            ,value:new Date()
        });
        //执行一个laydate实例
        laydate.render({
            elem: '#test4' //指定元素
            ,value:new Date()
        });
        //执行一个laydate实例
        laydate.render({
            elem: '#test6' //指定元素
            ,value:new Date()
        });
    });
</script>
</body>
</html>