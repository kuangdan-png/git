<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>员工管理系统</title>

    <link rel="stylesheet" href="layui/css/layui.css">
    <script src="layui/layui.js"></script>
    <script src="layui/layui.all.js"></script>
    <script src="JQuery/jquery-3.4.1.min.js"></script>
    <script src="layui/lay/modules/laydate.js"></script>
    <style>
        #button{
            display: none;
        }
        .address{
            width: 200px;
            padding: 7px 10px;
        }
    </style>
</head>
<body>

<hr/>
<div id="button">
    <!--<button id="insert"  type="button" class="layui-icon " style="margin:2px 0 0 30px;background-color: #88A3D4;">增加</button>-->
    <button id="insert" type="button" lay-event="add" class="layui-btn layui-btn-normal" style="background-color: #88A3D4; "><i class="layui-icon layui-icon-add-circle"></i>添加</button>
<button id="update" type="button" lay-event="update" class="layui-btn layui-btn-normal" style="background-color: #88A3D4; "><i class="layui-icon layui-icon-edit"></i>修改</button>
    <button id="delete" type="button" lay-event="delete" class="layui-btn layui-btn-normal" style="background-color: #88A3D4; "><i class="layui-icon layui-icon-close"></i>删除</button>
        <button id="select" type="button" lay-event="select" class="layui-btn layui-btn-normal" style="background-color: #88A3D4; "><i class="layui-icon layui-icon-search"></i>查询</button>

</div>
    <table class="layui-hide" id="employeestable" lay-filter="test"></table>
<div id="insertdiv" lay-filter="formTest" style="display: none">
    <form id="finsert" method="post" autocomplete="off" action="" lay-filter="finsert" class="layui-form">
        <table align="center" cellpadding="3px">
            <tr>
                <td>员工编号:</td>
                <td><input type="text" name="empNo" id="maxEmployeesId"  lay-verify="required" class="layui-input"  readonly="readonly">  </td>
            </tr>
            <tr>
                <td>员工名:</td>
                <td><input type="text" name="empName" id="employeesName" lay-verify="required" class="layui-input"></td>
            </tr>
            <tr>
                <td>性别:</td>
                <td>
                    <select name="empSex" id="employeesSex" lay-verify="required" class="layui-input">
                        <option value="男">男</option>
                        <option value="女">女</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>电子邮箱:</td>
                <td><input type="email" name="empEmail" id="employyesEmail" lay-verify="required" class="layui-input"></td>
            </tr>
            <tr>
                <td>联系电话:</td>
                <td><input type="text" name="empTel" id="employeesTel" lay-verify="required" class="layui-input"></td>
            </tr>
            <tr>
                <td>请选择省：</td>
                <td>
                    <select name="empProId" id="proName" lay-ignore class="address" lay-filter="proName">
                        <option value="" >省</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>请选择市：</td>
                <td>
                    <select  name="empCitId" id="citName" lay-ignore class="address" lay-filter="citName">
                        <option value="" >市</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>请选择区：</td>
                <td>
                    <select name="empDisId" id="disName" lay-ignore class="address" lay-filter="disName">
                        <option value="" >区/县</option>
                    </select>
                </td>
            </tr>
            <td>输入地址：</td>
            <td>
                <input type="text" name="empAddressNo" id="employeesAddressNo" placeholder="请输入详细地址" class="layui-input">
            </td>
            <tr>
                <td>出生日期:</td>
                <td><input type="text" name="empBirthdayStr" lay-verify="required" class="layui-input" id="empBirthdayStr"></td>
            </tr>

            <tr>
                <td>职务:</td>
                <td>
                    <div class="layui-form" >
                    <select name="empDutyNo" id="dutyList" lay-verify="required" class="zhiwu">
                        <!--<option value="">职务</option>-->
                    </select>
                    </div>
                </td>
            </tr>
            <tr>
                <td>入职日期:</td>
                <td><input type="text" name="empHiredateStr" lay-verify="required" class="layui-input" id="empHiredateStr"></td>
            </tr>
            <tr>
                <td>薪水:</td>
                <td><input type="text" name="empSalary" id="employeesSalary" lay-verify="required" value="5000" class="layui-input"></td>
            </tr>
            <tr>
                <td>提成比例:</td>
                <td><input type="text" name="empRatio" id="employeesRatio" lay-verify="required" value="0.0" class="layui-input"></td>
            </tr>
            <tr>
                <td>备注:</td>
                <td><input type="text" name="empRemark" id="employeesRemark" lay-verify="required" class="layui-input"></td>
            </tr>
            <tr>
                <td>用户名:</td>
                <td><input type="text" name="userName" id="empUserName" lay-verify="required" class="layui-input"></td>
            </tr>
            <tr>
                <td>密码:</td>
                <td><input type="password" name="userPass" id="empUserPass" lay-verify="required" class="layui-input"></td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <button type="button" lay-submit="" class="layui-btn" lay-filter="formokAdd">立即提交</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </td>
            </tr>
        </table>
    </form>

</div>
<div id="selectdiv" style="display: none">
    <form id="fselect" method="post" autocomplete="off" action="">
        <table align="center" cellpadding="3px">
            <tr>
                <td>员工编号:</td>
                <td><input type="text" id="empNo" name="empNo" lay-verify="required" class="layui-input">  </td>
            </tr>
            <tr>
                <td>员工名:</td>
                <td>
                    <input type="text" id="empName" name="empName" lay-verify="required" autocomplete="off" class="layui-input">
                </td>
            </tr>
            <tr>
                <td>联系电话:</td>
                <td><input type="text" id="empTel" name="empTel" lay-verify="required" class="layui-input"></td>
            </tr>
            <tr>
                <td>职务:</td>
                <td><input type="text" id="empDutyNo" name="empDutyNo" lay-verify="required" class="layui-input"> </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <button type="button" id="selectEmployees" class="layui-btn">立即提交</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </td>
            </tr>
        </table>
    </form>
</div>

<script type="text/javascript">
    $(".inputMailList").mailAutoComplete();//使用方法

    (function($) {
        $.fn.mailAutoComplete = function(options) {
            var defaults = {
                className: "emailist",
                email:  ["qq.com","gmail.com","126.com","163.com","hotmail.com","yahoo.com","yahoo.com.cn","live.com","sohu.com","sina.com"], //邮件数组
                zIndex: 11
            };
            // 最终参数
            var params = $.extend({}, defaults, options || {});

            // 是否现代浏览器
            var isModern = typeof window.screenX === "number", visibility = "visibility";
            // 键值与关键字
            var key = {
                "up": 38,
                "down": 40,
                "enter": 13,
                "esc": 27,
                "tab": 9
            };
            // 组装HTML的方法
            var fnEmailList = function(input) {
                var htmlEmailList = '', arrValue = input.value.split("@"), arrEmailNew = [];
                $.each(params.email, function(index, email) {
                    if (arrValue.length !== 2 || arrValue[1] === "" || email.indexOf(arrValue[1].toLowerCase()) === 0) {
                        arrEmailNew.push(email);
                    }
                });
                $.each(arrEmailNew, function(index, email) {
                    htmlEmailList = htmlEmailList + '<li'+ (input.indexSelected===index? ' class="on"':'') +'>'+ arrValue[0] + "@" + email +'</li>';
                });
                return htmlEmailList;
            };
            // 显示还是隐藏
            var fnEmailVisible = function(ul, isIndexChange) {
                var value = $.trim(this.value), htmlList = '';
                if (value === "" || (htmlList = fnEmailList(this)) === "") {
                    ul.css(visibility, "hidden");
                } else {
                    isIndexChange && (this.indexSelected = -1);
                    ul.css(visibility, "visible").html(htmlList);
                }
            };

            return $(this).each(function() {
                this.indexSelected = -1;
                // 列表容器创建
                var element = this;
                var eleUl = $('<ul></ul>').css({
                    position: "absolute",
                    marginTop: element.offsetHeight,
                    minWidth: element.offsetWidth - 2,
                    visibility: "hidden",
                    zIndex: params.zIndex
                }).addClass(params.className).bind("click", function(e) {
                    var target = e && e.target;
                    if (target && target.tagName.toLowerCase() === "li") {
                        $(element).val(target.innerHTML).trigger("input");
                        $(this).css(visibility, "hidden");
                        element.focus(); // add on 2013-11-20
                    }
                });
                $(this).before(eleUl);
                // IE6的宽度
                if (!window.XMLHttpRequest) { eleUl.width(element.offsetWidth - 2); }

                // 不同浏览器的不同事件
                isModern? $(this).bind("input", function() {
                    fnEmailVisible.call(this, eleUl, true);
                }): element.attachEvent("onpropertychange", function(e) {
                    if (e.propertyName !== "value") return;
                    fnEmailVisible.call(element, eleUl, true);
                });

                $(document).bind({
                    "click": function(e) {
                        var target = e && e.target, htmlList = '';
                        if (target == element && element.value && (htmlList = fnEmailList(element, params.email))) {
                            eleUl.css(visibility, "visible").html(htmlList);
                        } else if (target != eleUl.get(0) && target.parentNode != eleUl.get(0)) {
                            eleUl.css(visibility, "hidden");
                        }
                    },
                    "keydown": function(e) {
                        var eleLi = eleUl.find("li");
                        if (eleUl.css(visibility) === "visible") {
                            switch (e.keyCode) {
                                case key.up: {
                                    element.indexSelected--;
                                    if (element.indexSelected < 0) {
                                        element.indexSelected = -1 + eleLi.length;
                                    }
                                    e.preventDefault && e.preventDefault();
                                    break;
                                }
                                case key.down: {
                                    element.indexSelected++;
                                    if (element.indexSelected >= eleLi.length) {
                                        element.indexSelected = 0;
                                    }
                                    e.preventDefault && e.preventDefault();
                                    break;
                                }
                                case key.enter: {
                                    e.preventDefault();
                                    eleLi.get(element.indexSelected) && $(element).val(eleLi.eq(element.indexSelected).html());
                                    eleUl.css("visibility", "hidden");
                                    break;
                                }
                                case key.tab: case key.esc: {
                                eleUl.css("visibility", "hidden");
                                break;
                            }
                            }
                            if (element.indexSelected !== -1) {
                                eleUl.html(fnEmailList(element));
                            }
                        }
                    }
                });
            });
        };
    })(jQuery);
</script>
    <script>
        //日期和时间组件文档 - layui.laydate
        layui.use(['table','laydate'], function(){
            var laydate = layui.laydate;
            var table = layui.table;

            //执行一个laydate实例
            laydate.render({
                elem: '#empBirthdayStr' //指定元素
                ,type: 'datetime'
                ,format:"yyyy-MM-dd HH:mm:ss"
            });
            //执行一个laydate实例
            laydate.render({
                elem: '#empHiredateStr' //指定元素
                ,type: 'datetime'
                ,format:"yyyy-MM-dd HH:mm:ss"
            });
        });
        function createTime(v){
            var date=new Date(v)
            var y=date.getFullYear();
            var m=date.getMonth()+1;
            m=m<10?'0'+m:m;
            var d=date.getDate();
            d=d<10?("0"+d):d;
            var h=date.getHours();
            h=h<10?("0"+h):h;
            var M=date.getMinutes();
            M=m<10?("0"+M):M;
            var str=y+"-"+m+"-"+d+" "+h+":"+M;
            return str;
        }

        //模板方法将不同表格的数据合成一个列
        function createrFormat(o){
            return o;
        }

        //执行一个 table 实例
        layui.use(['laydate','table','element','form','layer'], function(){
            var table = layui.table;
            var element = layui.element;
            var form = layui.form;
            var  layer = layui.layer;
            $=layui.jquery;
            //第一个实例
            table.render({
                elem: '#employeestable'
                ,id:'emptable'
                ,url: 'employees/searchAllEmployeesInfo.action' //数据接口
                ,page: true //开启分页
                ,limits:[5,10,15]
                ,toolbar: '#button' //开启工具栏，此处显示默认图标，可以自定义模板，详见文档
                ,totalRow: true //开启合计行
                ,height:505
                ,cols: [[ //表头
                    {type: 'checkbox',fixed: 'left'}
                    ,{field: 'empNo',title: '员工编号', width:100}
                    ,{field: 'empName', title: '员工名', width:80}
                    ,{field: 'empSex', title: '性别', width:70}
                    ,{field: 'empEmail', title: '电子邮箱', width:150}
                    ,{field: 'empTel', title: '联系电话', width:150}
                    ,{templet:'<div>{{createrFormat(d.province.proName+d.city.citName+d.district.disName+d.empAddressNo)}}</div>', title: '家庭住址', width:200}
                    ,{field: 'empBirthday', title: '出生日期', width: 150,
                        templet:"<div>{{layui.util.toDateString(d.empBirthday, 'yyyy-MM-dd HH:mm:ss')}}</div>"
                    }
                    ,{templet:'<div>{{d.dutyList.dutName}}</div>', title: '职务', width: 80}
                    ,{field: 'empHiredate', title: '入职日期', width: 150,
                        templet:"<div>{{layui.util.toDateString(d.empHiredate, 'yyyy-MM-dd HH:mm:ss')}}</div>"
                    }
                    ,{field: 'empSalary', title: '薪水', width: 80}
                    ,{field: 'empRatio', title: '提成比例', width: 100}
                    ,{field: 'empRemark', title: '备注', width: 135}
                    ,{field: 'userName', title: '用户名', width: 135}
                ]], response: {
                    statusCode: 200 //重新规定成功的状态码为 200，table 组件默认为 0
                }, parseData: function (res) { //将原始数据解析成 table 组件所规定的数据
                    return {
                        "code": res.status, //解析接口状态
                        "msg": res.msg, //解析提示文本
                        "count": res.count, //解析数据长度
                        "data": res.row//解析数据列表
                    };
                }
                , page: true //开启分页
                ,defaultToolbar: ['filter',{
                    title: '提示' //标题
                    ,layEvent: 'LAYTABLE_TIPS' //事件名，用于 toolbar 事件中使用
                    ,icon: 'layui-icon-tips' //图标类名
                }]
                ,done: function (res, curr, count) {
                    currNum = curr;    //得到当前页码
                }
            });

            table.on('toolbar(test)',function (obj) {
                var checkStatus = table.checkStatus(obj.config.id)
                    , data = checkStatus.data; //获取选中的数据
                var proId=null;
                var citId=null;
                //console.log( checkStatus.data[0]);
                // var check = table.checkStatus(employeestable)
                switch (obj.event) {
                    case 'add':
                        //给入职日期添加默认值
                        var today=new Date();
                        var submitTime=today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate()+' '+today.getHours()+':'+today.getMinutes()+':'+today.getSeconds();
                        $("#empHiredateStr").attr('value',submitTime);
                        //清空option数据，不重复显示
                        $('#proName').html("");
                        $.ajax({
                            type:"POST",
                            url:'/supplieManager/selectAllprovince.action',  //从数据库查询返回的是个list
                            dataType: "json",
                            success: function (data) {
                                // window.alert(JSON.stringify(data));
                                /*$("#proName").html("");
                                $("#citName").html("");
                                $("#disName").html("");*/
                                $.each(data,function(index,item){
                                    $('#proName').append(new Option(item.proName,item.proId));//往下拉菜单里添加元素
                                });
                                form.render();
                            }
                        });
                        $("#proName").change(function () {
                            $("#citName").html("");
                            $("#disName").html("");
                            var checkred=JSON.stringify($("#proName option:selected").val());
                            // var aa=JSON.stringify($("#proName").val());
                            //alert(aa);
                            $.ajax({
                                type:"POST",
                                url:'/supplieManager/selectAllCity.action?processId='+checkred,  //从数据库查询返回的是个list
                                dataType: "json",
                                success: function (data) {
                                    $.each(data,function(index,item){
                                        $('#citName').append(new Option(item.citName,item.citId));//往下拉菜单里添加元素
                                    });
                                    form.render();
                                }
                            })
                        });
                        $("#citName").change(function () {
                            $("#disName").html("");
                            var checkrede=$("#citName option:selected").val();
                            //alert(checkrede);
                            //var bb=$("#citName").val();
                            //alert(bb);
                            $.ajax({
                                type:"POST",
                                url:'/supplieManager/selectAllArea.action?cityId='+checkrede,  //从数据库查询返回的是个list
                                dataType: "json",
                                success: function (data1) {
                                    $.each(data1,function(index,item){
                                        $('#disName').append(new Option(item.disName,item.disId));//往下拉菜单里添加元素
                                    });
                                    form.render();
                                }
                            })

                        });
                        $('#dutyList').html('');
                        $.ajax({//职务
                            type: "post",
                            url: 'employees/searchAllDutyListInfo.action',
                            data: '',
                            success: function (result) {
                                var data = result;
                                var selectstr = "";
                                for(var i =0;i<data.length;i++){
                                    if(i==0){
                                        selectstr = selectstr+"<option value='"+data[i].dutId+"'>"+data[i].dutName+"</option>"	;
                                    }else{
                                        selectstr = selectstr+"<option value='"+data[i].dutId+"'>"+data[i].dutName+"</option>"	;
                                    }
                                }
                                $("#dutyList").append(selectstr);
                                layui.use(['form'], function(){
                                    var form = layui.form;
                                    form.render();
                                    //各种基于事件的操作，下面会有进一步介绍
                                });
                            }
                        });
                        $.ajax({//制动为编号赋值
                            type: "post",
                            url: 'employees/searchMaxEmployeesId.action',
                            data: '',
                            success: function (result) {
                                $("#maxEmployeesId").attr("value",result);
                            }
                        });
                        layer.open({
                            //layer提供了5种层类型。可传入的值有：0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                            type:1,
                            closeBtn:1,
                            title:"新增员工信息",
                            area: ['40%','95%'],// $('#id')
                            content:$('#insertdiv'),
                            skin:'demo-class',
                            success: function(layero, index){
                                $('#insertdiv').css({"display": "block"});
                                //新增提交 监听表单提价按钮
                                form.on('submit(formokAdd)',function (data) {
                                    // alert(JSON.stringify(data));
                                    $.ajax({
                                        url:"employees/insertEmployeesInfo.action",
                                        type:'post',
                                        data:data.field,
                                        dataType:'JSON',
                                        success: function (data) {
                                            if(0!=data){
                                                layer.close(index);
                                                table.reload("emptable");
                                            }
                                        }
                                    });
                                });
                                $("#finsert")[0].reset();
                                layui.form.render();
                            },
                            end:function(layero, index){
                                $('#insertdiv').css({"display": "none"});
                                $("#finsert")[0].reset();
                                layui.form.render();
                            }
                        });
                        break;
                    case 'update':
                        if (data.length === 0) {
                            layer.msg('请选择一行');
                        } else if (data.length > 1) {
                            layer.msg('只能同时编辑一个');
                        } else {
                            $('#proName').html("");
                            $("#citName").html("");
                            $("#disName").html("");
                            $.ajax({
                                type:"POST",
                                url:'/warehouseManager/warehouseAllprovince.action',  //从数据库查询返回的是个list
                                dataType: "json",
                                success: function (data3) {
                                    $.each(data3,function(index,item){
                                        $('#proName').append(new Option(item.proName,item.proId));//往下拉菜单里添加元素
                                        checkStatus.data[0].province.proId
                                        if(checkStatus.data[0].province.proId==item.proId){
                                            $('#proName').val(checkStatus.data[0].province.proId);
                                        }
                                    });
                                    var checkred=JSON.stringify(data[0].province.proId);
                                    $.ajax({
                                        type:"POST",
                                        url:'/warehouseManager/warehouseAllCity.action?processId='+checkred,  //从数据库查询返回的是个list
                                        dataType: "json",
                                        success: function (data1) {
                                            $.each(data1,function(index1,item1){
                                                $('#citName').append(new Option(item1.citName,item1.citId));//往下拉菜单里添加元素
                                                if(checkStatus.data[0].city.citId==item1.citId){
                                                    $('#citName').val(checkStatus.data[0].city.citId)
                                                }
                                            });
                                            //form.render();
                                            // $("#citNameOne").val(data[0].citNo);
                                            var checkrede2=$("#citName option:selected").val();
                                            $.ajax({
                                                type:"POST",
                                                url:'/warehouseManager/warehouseAllArea.action?cityId='+checkrede2,  //从数据库查询返回的是个list
                                                dataType: "json",
                                                success: function (data2) {
                                                    $.each(data2,function(index2,item2){
                                                        $('#disName').append(new Option(item2.disName,item2.disId));//往下拉菜单里添加元素
                                                        if(checkStatus.data[0].district.disId==item2.disId){
                                                            $('#disName').val(checkStatus.data[0].district.disId)
                                                        }
                                                    });
                                                    // $("#disNameOne").val(data[0].disNo);
                                                }
                                            })

                                        }
                                    });
                                    form.render();
                                }
                            });
                            form.render();
                            $('#proName').html("");
                            $.ajax({
                                type:"POST",
                                url:'/warehouseManager/warehouseAllprovince.action',  //从数据库查询返回的是个list
                                dataType: "json",
                                success: function (data) {
                                    $("#proName").change(function () {
                                        // $("#citName").html("");
                                        // $("#disName").html("");
                                        $.each(data,function(index,item){
                                            console.log(checkStatus.data[0].empProId);
                                            $('#proName').append(new Option(item.proName,item.proId));//往下拉菜单里添加元素
                                            if(checkStatus.data[0].empProId==item.proId){
                                                $('#proName').val(checkStatus.data[0].empProId)
                                            }
                                        });
                                    });
                                }
                            });
                            $("#citName").html("");
                            $("#proName").change(function () {
                                $("#citName").html("");
                                $("#disName").html("");
                                var checkred=JSON.stringify($("#proName option:selected").val());
                                $.ajax({
                                    type:"POST",
                                    url:'/warehouseManager/warehouseAllCity.action?processId='+checkred,  //从数据库查询返回的是个list
                                    dataType: "json",
                                    success: function (data) {
                                        $.each(data,function(index,item){
                                            $('#citName').append(new Option(item.citName,item.citId));//往下拉菜单里添加元素
                                        });
                                    }
                                })
                            });
                            $("#disName").html("");
                            $("#citName").change(function () {
                                $("#disName").html("");
                                var checkrede=$("#citName option:selected").val();
                                //alert(checkrede);
                                //ar bb=$("#citName").val();
                                //alert(bb);
                                $.ajax({
                                    type:"POST",
                                    url:'/warehouseManager/warehouseAllArea.action?cityId='+checkrede,  //从数据库查询返回的是个list
                                    dataType: "json",
                                    success: function (data1) {
                                        $.each(data1,function(index,item){
                                            $('#disName').append(new Option(item.disName,item.disId));//往下拉菜单里添加元素
                                        });
                                    }
                                })

                            });

                            // alert("empProId"+checkStatus.data[0].province.proId);
                            // $("#empProIdO").val(checkStatus.data[0].province.proId);
                            // alert($("#empProIdO").val())
                            // //清空option数据，不重复显示
                            // $('#empProId').html('');
                            form.val('finsert', {
                                "empNo": checkStatus.data[0].empNo
                                , "empName": checkStatus.data[0].empName
                                , "empSex": checkStatus.data[0].empSex
                                , "empEmail": checkStatus.data[0].empEmail
                                , "empTel": checkStatus.data[0].empTel
                                , "empProId":checkStatus.data[0].empProId
                                , "empCitId": checkStatus.data[0].empCitId
                                , "empDisId": checkStatus.data[0].empDisId
                                ,"empAddressNo": checkStatus.data[0].empAddressNo
                                , "empBirthdayStr": checkStatus.data[0].empBirthday
                                , "empDutyNo": checkStatus.data[0].empDutyNo
                                , "empHiredateStr": checkStatus.data[0].empHiredate
                                , "empSalary": checkStatus.data[0].empSalary
                                , "empRatio": checkStatus.data[0].empRatio
                                , "empRemark": checkStatus.data[0].empRemark
                                , "userName": checkStatus.data[0].userName
                                , "userPass": checkStatus.data[0].userPass
                            });
                            form.render();

                            $.ajax({//职务
                                type: "post",
                                url: 'employees/searchAllDutyListInfo.action',
                                data: '',
                                success: function (result) {
                                    var data = result;
                                    var selectstr = "";
                                    for(var i =0;i<data.length;i++){

                                        if(i==0){
                                            selectstr = selectstr+"<option value='"+data[i].dutId+"'>"+data[i].dutName+"</option>"	;
                                        }else{
                                            selectstr = selectstr+"<option value='"+data[i].dutId+"'>"+data[i].dutName+"</option>"	;
                                        }
                                    }
                                    $("#dutyList").append(selectstr);
                                    layui.use(['form'], function(){
                                        var form = layui.form;
                                        form.render();
                                        //各种基于事件的操作，下面会有进一步介绍
                                    });
                                }
                            });

                            layer.open({
                                //layer提供了5种层类型。可传入的值有：0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                                type:1,
                                closeBtn:1,
                                title:"修改员工信息",
                                area: ['40%','95%'],// $('#id')
                                content:$('#insertdiv'),
                                skin:'demo-class',
                                success: function(layero, index){
                                    $('#insertdiv').css({"display": "block"});
                                    //新增提交 监听表单提价按钮
                                    form.on('submit(formokAdd)',function (data) {
                                        //获取行转JSON
                                        alert(JSON.stringify(data));
                                        $.ajax({
                                            url:"employees/updateEmployees.action",
                                            type:'post',
                                            data:data.field,
                                            dataType:'JSON',
                                            success: function (data) {
                                                if(0!=data){
                                                    layer.close(index);
                                                    table.reload("emptable");
                                                }
                                            }
                                        });
                                    });

                                },
                                end:function(layero, index){
                                    $('#insertdiv').css({"display": "none"});
                                    $("#finsert")[0].reset();
                                    layui.form.render();
                                }
                            });
                        }
                        break;
                    case 'delete':
                        if (data.length === 0) {
                            layer.msg('请选择一行');
                        } else {
                            layer.confirm("确认要删除吗？",function(index){
                                //获取被选中的行，对数组进行处理
                                var isCheckred=checkStatus.data;
                                var empNoStr="";
                                for(var i=0;i<isCheckred.length;i++){
                                    var empNo = isCheckred[i].empNo;
                                    empNoStr+=empNo;
                                    if(i != isCheckred.length - 1){
                                        empNoStr+=",";
                                    }
                                }
                                alert(empNoStr);
                                $.ajax({
                                    type: "post",
                                    url: 'employees/deleteEmployeesInfo.action',
                                    data: 'empNo='+empNoStr,
                                    dataType: "text",
                                    success: function (data) {
                                        if (data=="successed") {
                                            layer.msg('删除成功');
                                        } else {
                                            layer.msg('删除失败');
                                        }
                                        location.reload();
                                    }
                                });
                            });
                        }
                        break;
                    case 'select':
                        layer.open({
                            //layer提供了5种层类型。可传入的值有：0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                            type:1,
                            closeBtn:2,
                            title:"查询员工信息",
                            area: ['30%','41%'],// $('#id')
                            content:$('#selectdiv'),
                            skin:'demo-class',
                            success: function(layero, index){
                                $('#selectdiv').css({"display": "block"});
                                console.log("根据条件查询表格数据重新加载");
                                //根据条件查询表格数据重新加载
                                $('#selectEmployees').click(function(){
                                    //获取员工名
                                    var empNo = $('#empNo').val();
                                    console.log(empNo,empNo);
                                    var empName = $('#empName').val();
                                    var empTel = $('#empTel').val();
                                    var dutName = $('#empDutyNo').val();
                                    table.reload('emptable', {
                                        method: 'post'
                                        ,url: "employees/searchWhereEmployees.action"
                                        ,where: {
                                            empNo:empNo,
                                            empName:empName,
                                            empTel:empTel,
                                            dutName:dutName,
                                            page:1,
                                            limit:10
                                        }
                                    });
                                });
                            },
                            end:function(layero, index){
                                $('#selectdiv').css({"display": "none"});
                            }
                        });
                        break;
                }
            });
        });
    </script>
</body>
</html>