<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    <mapper namespace="supplier.crud">
    <!--用表连接查询supplier总条数，关联address地址表，province省，city市，district区-->
    <select id="countnum" resultType="int">
        select count(supID) from supplier
        inner join address on address.addId=supplier.supAddressNo
        inner join province on province.proId=address.addProvinceNo
        inner join city on city.citId=address.addCityNo
        inner join district on district.disId=address.addDistrictNo
    </select>
    <!--用表连接对supplier进行分页查询，查询地址，省，市，区等，关联address地址表，
    province省，city市，district区，然后对supID进行分组，及分页-->
    <select id="searchsuppliermapList" resultMap="suppliermap" parameterType="com.medicine.util.Page">
        select supID,supName,supLinkman,supPhone,supMoney,supAddressNo,
        address.addProvinceNo,address.addCityNo,address.addDistrictNo,
        (province.proName)as proName,(city.citName)as citName,
        (district.disName)as disName,(province.proID)as proID,(city.citID)as citID,
        (district.disID)as disID,group_concat(province.proName,city.citName,
        district.disName)as supAddress,supRegion,supDefault,supComment from supplier
        inner join address on address.addId=supplier.supAddressNo
        inner join province on province.proId=address.addProvinceNo
        inner join city on city.citId=address.addCityNo
        inner join district on district.disId=address.addDistrictNo
        group by supID
        /*order by supID desc*/
        <if test="page!=null and limit!=null">
            limit #{page},#{limit}
        </if>
    </select>
    <!--对supplier表进行新增-->
    <select id="supplierInsert" resultMap="suppliermap" parameterType="Supplier">
        Insert into supplier(supID,supName,supLinkman,supPhone,supMoney,supAddressNo,supAddress,supRegion,supDefault,supComment)
        VALUES(#{supID},#{supName},#{supLinkman},#{supPhone},#{supMoney},#{supAddressNo},#{supAddress},#{supRegion},#{supDefault},#{supComment})
    </select>
    <!--查询最大编号（查询supplier的所有信息，在通过supId排序，用limit去一条数据）-->
    <select id="searchSupplierIdMax" resultType="string">
        select * from supplier order by supId desc limit 1
    </select>
    <!--通过supID删除supplier表的一条或多条数据-->
    <select id="supplierDelete" resultMap="suppliermap" parameterType="String">
      delete from supplier where supID in
        <foreach item="supID" collection="array" index="no" open="(" separator="," close=")">
            #{supID}
        </foreach>
    </select>
    <!--通过supID编辑任意数据-->
    <select id="supplierUpdate" resultMap="suppliermap" parameterType="Supplier">
        UPDATE supplier SET supName = #{supName},supLinkman = #{supLinkman}, supPhone = #{supPhone}, supMoney = #{supMoney}, supAddressNo = #{supAddressNo}, supAddress = #{supAddress}, supRegion = #{supRegion}, supDefault = #{supDefault}, supComment = #{supComment}
         WHERE supID = #{supID}
    </select>

    <!--查询全部的省份信息 -->
    <select id="selectAllprovince"  parameterType="String" resultType="Province">
        select * from province
    </select>

    <!--通过citProvinceNo查询全部的城市信息 -->
    <select id="selectAllCity" parameterType="String"  resultType="City">
        select * from city where citProvinceNo=#{citProvinceNo}
    </select>

    <!--通过disCityNo查询全部的区信息 -->
    <select id="selectAllArea"  parameterType="String" resultType="District" >
        select * from district where disCityNo=#{disCityNo}
    </select>
    <!--通过省编号addProvinceNo，市编号addCityNo，区编号addDistrictNo查询地址表address编号-->
    <select id="selectSupAddressNo"  parameterType="java.util.Map" resultType="String" >
        select addId from address
        where addProvinceNo=#{proId}and addCityNo=#{citId} and addDistrictNo=#{disId}
    </select>

    <!--模糊查询供货商编号，名称，地址，电话，联系人，搜索框-->
    <select id="searchselect"  parameterType="java.util.Map" resultType="Supplier" >
       select supID,supName,supLinkman,supMoney,supPhone, supAddress,supRegion,supDefault,supComment from supplier
        where supID LIKE "%"#{a}"%" or supName LIKE "%"#{a}"%" or supLinkman LIKE "%"#{a}"%" or supPhone LIKE "%"#{a}"%" or supAddress LIKE "%"#{a}"%"
        group by supID
        order by supID desc
            limit
        <foreach collection="list" item="item" index="index" separator=",">
            #{item}
        </foreach>
       
    </select>
    <!--模糊查询总条数-->
    <select id="searchselectrows" resultType="int">
        select count(supID) from supplier
        where supID LIKE "%"#{supID}"%" or supName LIKE "%"#{supName}"%" or supLinkman LIKE "%"#{supLinkman}"%" or supPhone LIKE "%"#{supPhone}"%" or supAddress LIKE "%"#{supAddress}"%"
    </select>
    <resultMap id="suppliermap" type="Supplier">
        <id column="supID" property="supID"/>
        <result column="supName" property="supName"/>
        <result column="supLinkman" property="supLinkman"/>
        <result column="supPhone" property="supPhone"/>
        <result column="supMoney" property="supMoney"/>
        <result column="supAddressNo" property="supAddressNo"/>
        <result column="supAddress" property="supAddress"/>
        <result column="supRegion" property="supRegion"/>
        <result column="supDefault" property="supDefault"/>
        <result column="supComment" property="supComment"/>
        <association property="address" javaType="address" resultMap="address"></association>
    </resultMap>
    <resultMap id="address" type="address">
        <id column="addId" property="addId"></id>
        <result property="addProvinceNo" column="addProvinceNo"></result>
        <result property="addCityNo" column="addCityNo"></result>
        <result property="addDistrictNo" column="addDistrictNo"></result>
        <result property="addDetail" column="addDetail"></result>
    </resultMap>
</mapper>